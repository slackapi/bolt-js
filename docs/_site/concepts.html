<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
  
    <title>Slack | Bolt for JavaScript</title>
    <meta name="author" content="Slack">
    <meta name="description" content="A framework that makes Slack app development fast and straight-forward. With a single interface for Slack‚Äôs Web API, Events API, and interactive features, Bolt gives you the full power of the Slack platform out of the box.">
    <link rel="canonical" href="http://localhost:4000/bolt-js/concepts">
    <link href="https://a.slack-edge.com/17c88/style/rollup-slack_kit_legacy_adapters.css" rel="stylesheet" type="text/css">
    <link href="https://a.slack-edge.com/cc5205/style/rollup-api_site.css" rel="stylesheet" type="text/css">
    
    <link href="http://localhost:4000/bolt-js/assets/style.css" rel="stylesheet" type="text/css">
  
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    

    <!--[if lt IE 9]>
    <script src="https://a.slack-edge.com/ef0d/js/libs/html5shiv.js"></script>
    <![endif]-->
  
    <link id="favicon" rel="shortcut icon" href="http://localhost:4000/bolt-js/assets/bolt-favicon.png" sizes="16x16 32x32 48x48" type="image/png" />
  
  </head>


  <body>
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KFZ5MK7');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KFZ5MK7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <div class="wrapper">
      <div class="panel">
        <div class="sidebar-content">
  <div class="logo">
    <span class="icon">
      <img src="http://localhost:4000/bolt-js/assets/bolt-js-logo.svg">
    </span>

    <span class="name">
      Bolt
    </span>

    <!-- Liquid has no ternary operator, so this is just meant to exclude 
      english sections since they are at the root URL -->
    

    <span class="version">
      
      <a href="https://github.com/slackapi/bolt-js/releases/tag/%40slack/bolt%403.18.0">v3.18.0</a>
    </span>
  </div>

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/tutorial/getting-started"><li class="title">Getting started</li></a>
    <a href="http://localhost:4000/bolt-js/reference"><li class="title">Reference</li></a>
  </ul>

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/concepts#basic"><li class="title">Basic concepts</li></a>
     
    <a href="http://localhost:4000/bolt-js/concepts#message-listening">
      <li>Listening to messages</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#message-sending">
      <li>Sending messages</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#event-listening">
      <li>Listening to events</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#web-api">
      <li>Using the Web API</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#action-listening">
      <li>Listening to actions</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#action-respond">
      <li>Responding to actions</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#acknowledge">
      <li>Acknowledging requests</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#shortcuts">
      <li>Listening and responding to shortcuts</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#commands">
      <li>Listening and responding to commands</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#creating-modals">
      <li>Opening modals</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#updating-pushing-views">
      <li>Updating and pushing views</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#view-submissions">
      <li>Listening to views</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#publishing-views">
      <li>Publishing views to App Home</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#options">
      <li>Listening and responding to options</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#authenticating-oauth">
      <li>Authenticating with OAuth</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#socket-mode">
      <li>Using Socket Mode</li>
    </a>
    
  </ul>

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/concepts#advanced">
      <li class="title">Advanced concepts</li>
    </a>
     
    <a href="http://localhost:4000/bolt-js/concepts#error-handling">
      <li>Handling errors</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#authorization">
      <li>Authorization</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#token-rotation">
      <li>Token rotation</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#conversation-store">
      <li>Conversation stores</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#global-middleware">
      <li>Global middleware</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#listener-middleware">
      <li>Listener middleware</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#context">
      <li>Adding context</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#deferring-initialization">
      <li>Deferring App initialization</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#logging">
      <li>Logging</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#receiver">
      <li>Customizing a receiver</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#custom-routes">
      <li>Adding Custom HTTP routes</li>
    </a>
    
  </ul>

  
  
    <ul class="sidebar-section"> 
        <li class="title">Deployments</li>
      
        <a href="http://localhost:4000/bolt-js/deployments/aws-lambda">
          <li>AWS Lambda</li>
        </a>
      
        <a href="http://localhost:4000/bolt-js/deployments/heroku">
          <li>Heroku Platform</li>
        </a>
      
    </ul>
  

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/concepts#steps">
      <li class="title">
        Workflow steps
        <span class="label-deprecated">
          Deprecated
        </span>
      </li>
    </a>
     
      
    
      
      <a href="http://localhost:4000/bolt-js/concepts#creating-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          Creating workflow steps
        </li>
      </a>
      
    
      
      <a href="http://localhost:4000/bolt-js/concepts#adding-editing-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          Adding or editing workflow steps
        </li>
      </a>
      
    
      
      <a href="http://localhost:4000/bolt-js/concepts#saving-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          Saving step configurations
        </li>
      </a>
      
    
      
      <a href="http://localhost:4000/bolt-js/concepts#executing-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          Executing workflow steps
        </li>
      </a>
      
    
  </ul>

  <ul class="sidebar-section">
    
    
    <a href="http://localhost:4000/bolt-js/tutorial/getting-started-http">
      <li class="title">Getting started with HTTP</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/tutorial/hubot-migration">
      <li class="title">Migrating Hubot apps</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/tutorial/migration-v2">
      <li class="title">Migrating to V2</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/tutorial/migration-v3">
      <li class="title">Migrating to V3</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/tutorial/using-typescript">
      <li class="title">Using TypeScript</li>
    </a>
    
    <a href="https://github.com/SlackAPI/bolt-js/blob/main/.github/contributing.md">
      <li class="title">Contributing</li>
    </a>
  </ul>
</div>

      </div>

      <div class="content">
        <div class="mainheader">
          <div class="header">
  <div class="header_nav">
    <a href="https://github.com/SlackAPI/bolt-js" class="btn header_btn float_right"><ts-icon class="ts_icon_github"></ts-icon>Code on GitHub</a>
    <a href="https://api.slack.com" class="btn header_btn float_right"><ts-icon class="ts_icon_slack_pillow"></ts-icon>Slack Platform Home</a>
    <!-- If we add more languages, this logic will need to change -->
    
      <a href="http://localhost:4000/bolt-js/ja-jp" class="header_btn language-switcher float_right">Êó•Êú¨Ë™û (Japanese)</a>
    
    </div>
</div>
        </div>

        <div id="basic">
           
          <div class="section-wrapper">
            <h3 id="message-listening">Listening to messages</h3>

            <div class="section-content">
  <p>To listen to messages that <a href="https://api.slack.com/messaging/retrieving#permissions">your app has access to receive</a>, you can use the <code class="language-plaintext highlighter-rouge">message()</code> method which filters out events that aren‚Äôt of type <code class="language-plaintext highlighter-rouge">message</code>.</p>

  <p><code class="language-plaintext highlighter-rouge">message()</code> accepts an optional <code class="language-plaintext highlighter-rouge">pattern</code> parameter of type <code class="language-plaintext highlighter-rouge">string</code> or <code class="language-plaintext highlighter-rouge">RegExp</code> object which filters out any messages that don‚Äôt match the pattern.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td>
<td class="rouge-code"><pre><span class="c1">// This will match any message that contains üëã</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="dl">'</span><span class="s1">:wave:</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Handle only newly posted messages here</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">===</span> <span class="kc">undefined</span>
    <span class="o">||</span> <span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">bot_message</span><span class="dl">'</span>
    <span class="o">||</span> <span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">file_share</span><span class="dl">'</span>
    <span class="o">||</span> <span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">thread_broadcast</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">say</span><span class="p">(</span><span class="s2">`Hello, &lt;@</span><span class="p">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">user</span><span class="p">}</span><span class="s2">&gt;`</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<details class="secondary-wrapper">
  <summary class="section-head">
    <h4 class="section-head">Using a RegExp pattern</h4>
  </summary>

  <div class="secondary-content">
    <p>A RegExp pattern can be used instead of a string for more granular matching.</p>

    <p>All of the results of the RegExp match will be in <code class="language-plaintext highlighter-rouge">context.matches</code>.</p>
  </div>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="sr">/^</span><span class="se">(</span><span class="sr">hi|hello|hey</span><span class="se">)</span><span class="sr">.*/</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// RegExp matches are inside of context.matches</span>
  <span class="kd">const</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

  <span class="k">await</span> <span class="nx">say</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">greeting</span><span class="p">}</span><span class="s2">, how are you?`</span><span class="p">);</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

</details>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="message-sending">Sending messages</h3>

            <div class="section-content">
  <p>Within your listener function, <code class="language-plaintext highlighter-rouge">say()</code> is available whenever there is an associated conversation (for example, a conversation where the event or action which triggered the listener occurred). <code class="language-plaintext highlighter-rouge">say()</code> accepts a string to post simple messages and JSON payloads to send more complex messages. The message payload you pass in will be sent to the associated conversation.</p>

  <p>In the case that you‚Äôd like to send a message outside of a listener or you want to do something more advanced (like handle specific errors), you can call <code class="language-plaintext highlighter-rouge">chat.postMessage</code> <a href="#web-api">using the client attached to your Bolt instance</a>.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Listens for messages containing "knock knock" and responds with an italicized "who's there?"</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="dl">'</span><span class="s1">knock knock</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">say</span><span class="p">(</span><span class="s2">`_Who's there?_`</span><span class="p">);</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<details class="secondary-wrapper">
  <summary>
    <h4 class="secondary-header">Sending a message with blocks</h4>
  </summary>

  <div class="secondary-content">
    <p><code class="language-plaintext highlighter-rouge">say()</code> accepts more complex message payloads to make it easy to add functionality and structure to your messages.</p>

    <p>To explore adding rich message layouts to your app, read through <a href="https://api.slack.com/messaging/composing/layouts">the guide on our API site</a> and look through templates of common app flows <a href="https://api.slack.com/tools/block-kit-builder?template=1">in the Block Kit Builder</a>.</p>
  </div>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Sends a section block with datepicker when someone reacts with a üìÖ emoji</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="dl">'</span><span class="s1">reaction_added</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">reaction</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">calendar</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">say</span><span class="p">({</span>
      <span class="na">blocks</span><span class="p">:</span> <span class="p">[{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">section</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mrkdwn</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pick a date for me to remind you</span><span class="dl">"</span>
        <span class="p">},</span>
        <span class="dl">"</span><span class="s2">accessory</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">datepicker</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">action_id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">datepicker_remind</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">initial_date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2019-04-28</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">placeholder</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">plain_text</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Select a date</span><span class="dl">"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}]</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>
</details>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="event-listening">Listening to events</h3>

            <div class="section-content">
  <p>You can listen to <a href="https://api.slack.com/events">any Events API event</a> using the <code class="language-plaintext highlighter-rouge">event()</code> method after subscribing to it in your app configuration. This allows your app to take action when something happens in Slack, like a user reacting to a message or joining a channel.</p>

  <p>The <code class="language-plaintext highlighter-rouge">event()</code> method requires an <code class="language-plaintext highlighter-rouge">eventType</code> of type string.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">welcomeChannelId</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">C12345</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// When a user joins the team, send a message in a predefined channel asking them to introduce themselves</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="dl">'</span><span class="s1">team_join</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Call chat.postMessage with the built-in client</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
      <span class="na">channel</span><span class="p">:</span> <span class="nx">welcomeChannelId</span><span class="p">,</span>
      <span class="na">text</span><span class="p">:</span> <span class="s2">`Welcome to the team, &lt;@</span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">&gt;! üéâ You can introduce yourself in this channel.`</span>
    <span class="p">});</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<details class="secondary-wrapper">
  <summary class="section-head">
    <h4 class="section-head">Filtering on message subtypes</h4>
  </summary>

  <div class="secondary-content">
    <p>A <code class="language-plaintext highlighter-rouge">message()</code> listener is equivalent to <code class="language-plaintext highlighter-rouge">event('message')</code></p>

    <p>You can filter on subtypes of events by using the built-in <code class="language-plaintext highlighter-rouge">subtype()</code> middleware. Common message subtypes like <code class="language-plaintext highlighter-rouge">message_changed</code> and <code class="language-plaintext highlighter-rouge">message_replied</code> can be found <a href="https://api.slack.com/events/message#message_subtypes">on the message event page</a>.</p>
  </div>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Import subtype from the package</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span><span class="p">,</span> <span class="nx">subtype</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Matches all message changes from users</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="nx">subtype</span><span class="p">(</span><span class="dl">'</span><span class="s1">message_changed</span><span class="dl">'</span><span class="p">),</span> <span class="p">({</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// This if statement is required in TypeScript code</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">message_changed</span><span class="dl">'</span>
    <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span>
    <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">previous_message</span><span class="p">.</span><span class="nx">subtype</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`The user </span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">user</span><span class="p">}</span><span class="s2"> changed their message from </span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">previous_message</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2"> to </span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

</details>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="web-api">Using the Web API</h3>

            <div class="section-content">
  <p>You can call <a href="https://api.slack.com/methods">any Web API method</a> using the <a href="https://slack.dev/node-slack-sdk/web-api"><code class="language-plaintext highlighter-rouge">WebClient</code></a> provided to your app‚Äôs listeners as <code class="language-plaintext highlighter-rouge">client</code>. This uses either the token that initialized your app <b>or</b> the token that is returned from the <a href="#authorization"><code class="language-plaintext highlighter-rouge">authorize</code> function</a> for the incoming event. The built-in <a href="#authenticating-oauth">OAuth support</a> handles the second case by default.</p>

  <p>Your Bolt app also has a top-level <code class="language-plaintext highlighter-rouge">app.client</code> which you can manually pass the <code class="language-plaintext highlighter-rouge">token</code> parameter. If the incoming request is not authorized or you‚Äôre calling a method from outside of a listener, use the top-level <code class="language-plaintext highlighter-rouge">app.client</code>.</p>

  <p>Calling one of the <a href="https://slack.dev/node-slack-sdk/web-api"><code class="language-plaintext highlighter-rouge">WebClient</code></a>‚Äôs methods will return a Promise containing the response from Slack, regardless of whether you use the top-level or listener‚Äôs client.</p>

  <p>Since the introduction of <a href="https://api.slack.com/enterprise/apps">org wide app installations</a>, <a href="https://api.slack.com/enterprise/apps/changes-apis#methods">some web-api methods</a> now require <code class="language-plaintext highlighter-rouge">team_id</code> to indicate which workspace to act on. Bolt for JavaScript will attempt to infer the <code class="language-plaintext highlighter-rouge">team_id</code> based on incoming payloads and pass it along to <code class="language-plaintext highlighter-rouge">client</code>. This is handy for existing applications looking to add support for org wide installations and not spend time updating all of these web-api calls.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Unix Epoch time for September 30, 2019 11:59:59 PM</span>
<span class="kd">const</span> <span class="nx">whenSeptemberEnds</span> <span class="o">=</span> <span class="mi">1569887999</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="dl">'</span><span class="s1">wake me up</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Call chat.scheduleMessage with the built-in client</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">scheduleMessage</span><span class="p">({</span>
      <span class="na">channel</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">,</span>
      <span class="na">post_at</span><span class="p">:</span> <span class="nx">whenSeptemberEnds</span><span class="p">,</span>
      <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Summer has come and passed</span><span class="dl">'</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="action-listening">Listening to actions</h3>

            <div class="section-content">
  <p>Your app can listen to user actions like button clicks, and menu selects, using the <code class="language-plaintext highlighter-rouge">action</code> method.</p>

  <p>Actions can be filtered on an <code class="language-plaintext highlighter-rouge">action_id</code> of type string or RegExp object. <code class="language-plaintext highlighter-rouge">action_id</code>s act as unique identifiers for interactive components on the Slack platform.</p>

  <p>You‚Äôll notice in all <code class="language-plaintext highlighter-rouge">action()</code> examples, <code class="language-plaintext highlighter-rouge">ack()</code> is used. It is required to call the <code class="language-plaintext highlighter-rouge">ack()</code> function within an action listener to acknowledge that the request was received from Slack. This is discussed in the <a href="#acknowledge">acknowledging requests section</a>.</p>

  <p><em>Note: Since v2, message shortcuts (previously message actions) now use the <code class="language-plaintext highlighter-rouge">shortcut()</code> method instead of the <code class="language-plaintext highlighter-rouge">action()</code> method. View the <a href="https://slack.dev/bolt/tutorial/migration-v2">migration guide for V2</a> to learn about the changes.</em></p>

  <p>Learn more about the <code class="language-plaintext highlighter-rouge">block_actions</code> payload, <a href="https://api.slack.com/reference/interaction-payloads">here</a>. To access the full payload of a view from within a listener, reference the <code class="language-plaintext highlighter-rouge">body</code> argument within your callback function.</p>

</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Your listener function will be called every time an interactive component with the action_id "approve_button" is triggered</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="dl">'</span><span class="s1">approve_button</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>
  <span class="c1">// Update the message to reflect the action</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<details class="secondary-wrapper">
  <summary class="section-head">
    <h4 class="section-head">Listening to actions using a constraint object</h4>
  </summary>

  <div class="secondary-content">
    <p>You can use a constraints object to listen to <code class="language-plaintext highlighter-rouge">callback_id</code>s, <code class="language-plaintext highlighter-rouge">block_id</code>s, and <code class="language-plaintext highlighter-rouge">action_id</code>s (or any combination of them). Constraints in the object can be of type string or RegExp object.</p>
  </div>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Your listener function will only be called when the action_id matches 'select_user' AND the block_id matches 'assign_ticket'</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">({</span> <span class="na">action_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select_user</span><span class="dl">'</span><span class="p">,</span> <span class="na">block_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">assign_ticket</span><span class="dl">'</span> <span class="p">},</span>
  <span class="k">async</span> <span class="p">({</span> <span class="nx">body</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// Make sure the action isn't from a view (modal or app home)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">reactions</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span>
          <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">white_check_mark</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">timestamp</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">ts</span><span class="p">,</span>
          <span class="na">channel</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">id</span>
        <span class="p">});</span>

        <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

</details>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="action-respond">Responding to actions</h3>

            <div class="section-content">
  <p>There are two main ways to respond to actions. The first (and most common) way is to use the <code class="language-plaintext highlighter-rouge">say</code> function. The <code class="language-plaintext highlighter-rouge">say</code> function sends a message back to the conversation where the incoming request took place.</p>

  <p>The second way to respond to actions is using <code class="language-plaintext highlighter-rouge">respond()</code>, which is a simple utility to use the <code class="language-plaintext highlighter-rouge">response_url</code> associated with an action.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Your middleware will be called every time an interactive component with the action_id ‚Äúapprove_button‚Äù is triggered</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="dl">'</span><span class="s1">approve_button</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Acknowledge action request</span>
  <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>
  <span class="k">await</span> <span class="nx">say</span><span class="p">(</span><span class="dl">'</span><span class="s1">Request approved üëç</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<details class="secondary-wrapper">
  <summary class="section-head">
    <h4 class="section-head">Using respond()</h4>
  </summary>

  <div class="secondary-content">
    <p>Since <code class="language-plaintext highlighter-rouge">respond()</code> is a utility for calling the <code class="language-plaintext highlighter-rouge">response_url</code>, it behaves in the same way. You can pass a JSON object with a new message payload that will be published back to the source of the original interaction with optional properties like <code class="language-plaintext highlighter-rouge">response_type</code> (which has a value of <code class="language-plaintext highlighter-rouge">in_channel</code> or <code class="language-plaintext highlighter-rouge">ephemeral</code>), <code class="language-plaintext highlighter-rouge">replace_original</code>, and <code class="language-plaintext highlighter-rouge">delete_original</code>.</p>
  </div>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Listens to actions triggered with action_id of ‚Äúuser_select‚Äù</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="dl">'</span><span class="s1">user_select</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">respond</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">users_select</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">respond</span><span class="p">(</span><span class="s2">`You selected &lt;@</span><span class="p">${</span><span class="nx">action</span><span class="p">.</span><span class="nx">selected_user</span><span class="p">}</span><span class="s2">&gt;`</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

</details>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="acknowledge">Acknowledging requests</h3>

            <div class="section-content">
  <p>Actions, commands, and options requests must <strong>always</strong> be acknowledged using the <code class="language-plaintext highlighter-rouge">ack()</code> function. This lets Slack know that the request was received and updates the Slack user interface accordingly. Depending on the type of request, your acknowledgement may be different. For example, when acknowledging a modal submission you will call <code class="language-plaintext highlighter-rouge">ack()</code> with validation errors if the submission contains errors, or with no parameters if the submission is valid.</p>

  <p>We recommend calling <code class="language-plaintext highlighter-rouge">ack()</code> right away before sending a new message or fetching information from your database since you only have 3 seconds to respond.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Regex to determine if this is a valid email</span>
<span class="kd">let</span> <span class="nx">isEmail</span> <span class="o">=</span> <span class="sr">/^</span><span class="se">[\w\-\.]</span><span class="sr">+@</span><span class="se">([\w\-]</span><span class="sr">+</span><span class="se">\.)</span><span class="sr">+</span><span class="se">[\w\-]</span><span class="sr">+$/</span><span class="p">;</span>
<span class="c1">// This uses a constraint object to listen for modal submissions with a callback_id of ticket_submit </span>
<span class="nx">app</span><span class="p">.</span><span class="nx">view</span><span class="p">(</span><span class="dl">'</span><span class="s1">ticket_submit</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">view</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// get the email value from the input block with `email_address` as the block_id</span>
  <span class="kd">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="dl">'</span><span class="s1">email_address</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">input_a</span><span class="dl">'</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>

  <span class="c1">// if it‚Äôs a valid email, accept the submission</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">email</span> <span class="o">&amp;&amp;</span> <span class="nx">isEmail</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">email</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// if it isn‚Äôt a valid email, acknowledge with an error</span>
    <span class="k">await</span> <span class="nx">ack</span><span class="p">({</span>
      <span class="dl">"</span><span class="s2">response_action</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">errors</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">errors</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">email_address</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Sorry, this isn‚Äôt a valid email</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="shortcuts">Listening and responding to shortcuts</h3>

            <div class="section-content">

  <p>The <code class="language-plaintext highlighter-rouge">shortcut()</code> method supports both <a href="https://api.slack.com/interactivity/shortcuts/using#global_shortcuts">global shortcuts</a> and <a href="https://api.slack.com/interactivity/shortcuts/using#message_shortcuts">message shortcuts</a>.</p>

  <p>Shortcuts are invokable entry points to apps. Global shortcuts are available from within search in Slack. Message shortcuts are available in the context menus of messages. Your app can use the <code class="language-plaintext highlighter-rouge">shortcut()</code> method to listen to incoming shortcut requests. The method requires a <code class="language-plaintext highlighter-rouge">callback_id</code> parameter of type <code class="language-plaintext highlighter-rouge">string</code> or <code class="language-plaintext highlighter-rouge">RegExp</code>.</p>

  <p>‚ö†Ô∏è Note that if you use <code class="language-plaintext highlighter-rouge">shortcut()</code> multiple times with overlapping RegExp matches, <em>all</em> matching listeners will run. Design your regular expressions to avoid this possibility.</p>

  <p>Shortcuts must be acknowledged with <code class="language-plaintext highlighter-rouge">ack()</code> to inform Slack that your app has received the request.</p>

  <p>Shortcuts include a <code class="language-plaintext highlighter-rouge">trigger_id</code> which an app can use to <a href="#creating-modals">open a modal</a> that confirms the action the user is taking.</p>

  <p>When configuring shortcuts within your app configuration, you‚Äôll continue to append <code class="language-plaintext highlighter-rouge">/slack/events</code> to your request URL.</p>

  <p>‚ö†Ô∏è Note that global shortcuts do <strong>not</strong> include a channel ID. If your app needs access to a channel ID, you may use a <a href="https://api.slack.com/reference/block-kit/block-elements#conversation_select"><code class="language-plaintext highlighter-rouge">conversations_select</code></a> element within a modal. Message shortcuts do include channel ID.</p>

</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td>
<td class="rouge-code"><pre><span class="c1">// The open_modal shortcut opens a plain old modal</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">shortcut</span><span class="p">(</span><span class="dl">'</span><span class="s1">open_modal</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">shortcut</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Acknowledge shortcut request</span>
    <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>

    <span class="c1">// Call the views.open method using one of the built-in WebClients</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">views</span><span class="p">.</span><span class="nx">open</span><span class="p">({</span>
      <span class="na">trigger_id</span><span class="p">:</span> <span class="nx">shortcut</span><span class="p">.</span><span class="nx">trigger_id</span><span class="p">,</span>
      <span class="na">view</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">modal</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">title</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">plain_text</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">My App</span><span class="dl">"</span>
        <span class="p">},</span>
        <span class="na">close</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">plain_text</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Close</span><span class="dl">"</span>
        <span class="p">},</span>
        <span class="na">blocks</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">section</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mrkdwn</span><span class="dl">"</span><span class="p">,</span>
              <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">About the simplest modal you could conceive of :smile:</span><span class="se">\n\n</span><span class="s2">Maybe &lt;https://api.slack.com/reference/block-kit/interactive-components|*make the modal interactive*&gt; or &lt;https://api.slack.com/surfaces/modals/using#modifying|*learn more advanced modal use cases*&gt;.</span><span class="dl">"</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">elements</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mrkdwn</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Psssst this modal was designed using &lt;https://api.slack.com/tools/block-kit-builder|*Block Kit Builder*&gt;</span><span class="dl">"</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<details class="secondary-wrapper">
  <summary class="section-head">
    <h4 class="section-head">Listening to shortcuts using a constraint object</h4>
  </summary>

  <div class="secondary-content">
    <p>You can use a constraints object to listen to <code class="language-plaintext highlighter-rouge">callback_id</code>s, and <code class="language-plaintext highlighter-rouge">type</code>s. Constraints in the object can be of type string or RegExp object.</p>
  </div>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td>
<td class="rouge-code"><pre>  <span class="c1">// Your middleware will only be called when the callback_id matches 'open_modal' AND the type matches 'message_action'</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">shortcut</span><span class="p">({</span> <span class="na">callback_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">open_modal</span><span class="dl">'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">message_action</span><span class="dl">'</span> <span class="p">},</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">shortcut</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// Acknowledge shortcut request</span>
      <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>

      <span class="c1">// Call the views.open method using one of the built-in WebClients</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">views</span><span class="p">.</span><span class="nx">open</span><span class="p">({</span>
        <span class="na">trigger_id</span><span class="p">:</span> <span class="nx">shortcut</span><span class="p">.</span><span class="nx">trigger_id</span><span class="p">,</span>
        <span class="na">view</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">modal</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">title</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">plain_text</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">My App</span><span class="dl">"</span>
          <span class="p">},</span>
          <span class="na">close</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">plain_text</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Close</span><span class="dl">"</span>
          <span class="p">},</span>
          <span class="na">blocks</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">section</span><span class="dl">"</span><span class="p">,</span>
              <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mrkdwn</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">About the simplest modal you could conceive of :smile:</span><span class="se">\n\n</span><span class="s2">Maybe &lt;https://api.slack.com/reference/block-kit/interactive-components|*make the modal interactive*&gt; or &lt;https://api.slack.com/surfaces/modals/using#modifying|*learn more advanced modal use cases*&gt;.</span><span class="dl">"</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">context</span><span class="dl">"</span><span class="p">,</span>
              <span class="na">elements</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mrkdwn</span><span class="dl">"</span><span class="p">,</span>
                  <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Psssst this modal was designed using &lt;https://api.slack.com/tools/block-kit-builder|*Block Kit Builder*&gt;</span><span class="dl">"</span>
                <span class="p">}</span>
              <span class="p">]</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">});</span>

      <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

</details>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="commands">Listening and responding to commands</h3>

            <div class="section-content">
  <p>Your app can use the <code class="language-plaintext highlighter-rouge">command()</code> method to listen to incoming slash command requests. The method requires a <code class="language-plaintext highlighter-rouge">commandName</code> of type string or RegExp.</p>

  <p>‚ö†Ô∏è Note that if you use <code class="language-plaintext highlighter-rouge">command()</code> multiple times with overlapping RegExp matches, <em>all</em> matching listeners will run. Design your regular expressions to avoid this possibility.</p>

  <p>Commands must be acknowledged with <code class="language-plaintext highlighter-rouge">ack()</code> to inform Slack your app has received the request.</p>

  <p>There are two ways to respond to slash commands. The first way is to use <code class="language-plaintext highlighter-rouge">say()</code>, which accepts a string or JSON payload. The second is <code class="language-plaintext highlighter-rouge">respond()</code> which is a utility for the <code class="language-plaintext highlighter-rouge">response_url</code>. These are explained in more depth in the <a href="#action-respond">responding to actions</a> section.</p>

  <p>When configuring commands within your app configuration, you‚Äôll continue to append <code class="language-plaintext highlighter-rouge">/slack/events</code> to your request URL.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre><span class="c1">// The echo command simply echoes on command</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="dl">'</span><span class="s1">/echo</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">command</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">respond</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Acknowledge command request</span>
  <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>

  <span class="k">await</span> <span class="nx">respond</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">command</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="creating-modals">Opening modals</h3>

            <div class="section-content">
  <p><a href="https://api.slack.com/block-kit/surfaces/modals">Modals</a> are focused surfaces that allow you to collect user data and display dynamic information. You can open a modal by passing a valid <code>trigger_id</code> and a <a href="https://api.slack.com/reference/block-kit/views">view payload</a> to the built-in client‚Äôs <a href="https://api.slack.com/methods/views.open"><code>views.open</code></a> method.</p>

  <p>Your app receives <code>trigger_id</code>s in payloads sent to your Request URL triggered user invocation like a slash command, button press, or interaction with a select menu.</p>

  <p>Read more about modal composition in the <a href="https://api.slack.com/surfaces/modals/using#composing_views">API documentation</a>.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Listen for a slash command invocation</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="dl">'</span><span class="s1">/ticket</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">body</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Acknowledge the command request</span>
  <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Call views.open with the built-in client</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">views</span><span class="p">.</span><span class="nx">open</span><span class="p">({</span>
      <span class="c1">// Pass a valid trigger_id within 3 seconds of receiving it</span>
      <span class="na">trigger_id</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">trigger_id</span><span class="p">,</span>
      <span class="c1">// View payload</span>
      <span class="na">view</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">modal</span><span class="dl">'</span><span class="p">,</span>
        <span class="c1">// View identifier</span>
        <span class="na">callback_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">view_1</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">title</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Modal title</span><span class="dl">'</span>
        <span class="p">},</span>
        <span class="na">blocks</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">section</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mrkdwn</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Welcome to a modal with _blocks_</span><span class="dl">'</span>
            <span class="p">},</span>
            <span class="na">accessory</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Click me!</span><span class="dl">'</span>
              <span class="p">},</span>
              <span class="na">action_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">button_abc</span><span class="dl">'</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">block_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">input_c</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">label</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">What are your hopes and dreams?</span><span class="dl">'</span>
            <span class="p">},</span>
            <span class="na">element</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text_input</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">action_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">dreamy_input</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">multiline</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="na">submit</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Submit</span><span class="dl">'</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="updating-pushing-views">Updating and pushing views</h3>

            <div class="section-content">
  <p>Modals contain a stack of views. When you call <a href="https://api.slack.com/methods/views.open"><code class="language-plaintext highlighter-rouge">views.open</code></a>, you add the root view to the modal. After the initial call, you can dynamically update a view by calling <a href="https://api.slack.com/methods/views.update"><code class="language-plaintext highlighter-rouge">views.update</code></a>, or stack a new view on top of the root view by calling <a href="https://api.slack.com/methods/views.push"><code class="language-plaintext highlighter-rouge">views.push</code></a>.</p>

  <p><strong><code>views.update</code></strong><br>
To update a view, you can use the built-in client to call <code>views.update</code> with the <code>view_id</code> that was generated when you opened the view, and a new <code>view</code> including the updated <code>blocks</code> array. If you‚Äôre updating the view when a user interacts with an element inside of an existing view, the <code>view_id</code> will be available in the <code>body</code> of the request.</p>

  <p><strong><code>views.push</code></strong><br>
To push a new view onto the view stack, you can use the built-in client to call <code>views.push</code> with a valid <code>trigger_id</code> a new <a href="https://api.slack.com/reference/block-kit/views">view payload</a>. The arguments for <code class="language-plaintext highlighter-rouge">views.push</code> is the same as <a href="#creating-modals">opening modals</a>. After you open a modal, you may only push two additional views onto the view stack.</p>

  <p>Learn more about updating and pushing views in our <a href="https://api.slack.com/surfaces/modals/using#modifying">API documentation</a>.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Listen for a button invocation with action_id `button_abc` (assume it's inside of a modal)</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="dl">'</span><span class="s1">button_abc</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">body</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Acknowledge the button request</span>
  <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">type</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">block_actions</span><span class="dl">'</span> <span class="o">||</span> <span class="o">!</span><span class="nx">body</span><span class="p">.</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Call views.update with the built-in client</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">views</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span>
      <span class="c1">// Pass the view_id</span>
      <span class="na">view_id</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
      <span class="c1">// Pass the current hash to avoid race conditions</span>
      <span class="na">hash</span><span class="p">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span>
      <span class="c1">// View payload with updated blocks</span>
      <span class="na">view</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">modal</span><span class="dl">'</span><span class="p">,</span>
        <span class="c1">// View identifier</span>
        <span class="na">callback_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">view_1</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">title</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Updated modal</span><span class="dl">'</span>
        <span class="p">},</span>
        <span class="na">blocks</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">section</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">You updated the modal!</span><span class="dl">'</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">image_url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://media.giphy.com/media/SVZGEcYt7brkFUyU90/giphy.gif</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">alt_text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Yay! The modal was updated</span><span class="dl">'</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="view-submissions">Listening to views</h3>

            <div class="section-content">

  <p>You may listen for user interactions with views using the <code class="language-plaintext highlighter-rouge">view</code> method.</p>

  <p>Slack will send a <code class="language-plaintext highlighter-rouge">view_submission</code> request when a user submits a view. To receive the values submitted in <a href="https://api.slack.com/reference/interaction-payloads/views">view</a> input blocks, you can access the <code class="language-plaintext highlighter-rouge">state</code> object. <code class="language-plaintext highlighter-rouge">state</code> contains a <code class="language-plaintext highlighter-rouge">values</code> object that uses the <code class="language-plaintext highlighter-rouge">block_id</code> and unique <code class="language-plaintext highlighter-rouge">action_id</code> to store the input values.
If the <code class="language-plaintext highlighter-rouge">notify_on_close</code> field of a view has been set to <code class="language-plaintext highlighter-rouge">true</code>, Slack will also send a <code class="language-plaintext highlighter-rouge">view_closed</code> request if a user clicks the close button. See the section on <strong>Handling views on close</strong> for more detail.
To listen to either a <code class="language-plaintext highlighter-rouge">view_submission</code> request or <code class="language-plaintext highlighter-rouge">view_closed</code> request, you can use the built-in <code class="language-plaintext highlighter-rouge">view()</code> method.</p>

  <p><code class="language-plaintext highlighter-rouge">view()</code> requires a <code class="language-plaintext highlighter-rouge">callback_id</code> of type <code class="language-plaintext highlighter-rouge">string</code> or <code class="language-plaintext highlighter-rouge">RegExp</code> or a constraint object with properties <code class="language-plaintext highlighter-rouge">type</code> and <code class="language-plaintext highlighter-rouge">callback_id</code>.</p>

  <hr>

  <h5 id="update-views-on-submission">Update views on submission</h5>

  <p>To update a view in response to a <code class="language-plaintext highlighter-rouge">view_submission</code> request, you may pass a <code class="language-plaintext highlighter-rouge">response_action</code> of type <code class="language-plaintext highlighter-rouge">update</code> with a newly composed <code class="language-plaintext highlighter-rouge">view</code> to display in your acknowledgement.</p>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Update the view on submission </span>
<span class="nx">app</span><span class="p">.</span><span class="nx">view</span><span class="p">(</span><span class="dl">'</span><span class="s1">modal-callback-id</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">body</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">ack</span><span class="p">({</span>
    <span class="na">response_action</span><span class="p">:</span> <span class="dl">'</span><span class="s1">update</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">view</span><span class="p">:</span> <span class="nx">buildNewModalView</span><span class="p">(</span><span class="nx">body</span><span class="p">),</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>
  <p>Similarly, there are options for <a href="https://api.slack.com/surfaces/modals/using#displaying_errors">displaying errors</a> in response to view submissions.</p>

  <p>Read more about view submissions in our <a href="https://api.slack.com/surfaces/modals/using#handling_submissions">API documentation</a>.</p>

  <hr>

  <h5 id="handling-views-on-close">Handling views on close</h5>

  <p>üí° When listening for <code class="language-plaintext highlighter-rouge">view_closed</code> requests, you must pass an object containing <code class="language-plaintext highlighter-rouge">type: 'view_closed'</code> and the view <code class="language-plaintext highlighter-rouge">callback_id</code>. See below for an example of this:</p>

  <p>See the <a href="https://api.slack.com/surfaces/modals/using#modal_cancellations">API documentation</a> for more information about <code class="language-plaintext highlighter-rouge">view_closed</code>.</p>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Handle a view_closed request</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">view</span><span class="p">({</span> <span class="na">callback_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">view_b</span><span class="dl">'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">view_closed</span><span class="dl">'</span> <span class="p">},</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">body</span><span class="p">,</span> <span class="nx">view</span><span class="p">,</span> <span class="nx">client</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Acknowledge the view_closed request</span>
  <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>
  <span class="c1">// react on close request</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Handle a view_submission request</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">view</span><span class="p">(</span><span class="dl">'</span><span class="s1">view_b</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">body</span><span class="p">,</span> <span class="nx">view</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Acknowledge the view_submission request</span>
  <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>

  <span class="c1">// Do whatever you want with the input data - here we're saving it to a DB then sending the user a verification of their submission</span>

  <span class="c1">// Assume there's an input block with `block_1` as the block_id and `input_a`</span>
  <span class="kd">const</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">view</span><span class="p">[</span><span class="dl">'</span><span class="s1">state</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">values</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">block_1</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">input_a</span><span class="dl">'</span><span class="p">];</span>
  <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">body</span><span class="p">[</span><span class="dl">'</span><span class="s1">user</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">];</span>

  <span class="c1">// Message to send user</span>
  <span class="kd">let</span> <span class="nx">msg</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
  <span class="c1">// Save to DB</span>
  <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// DB save was successful</span>
    <span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Your submission was successful</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">There was an error with your submission</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Message the user</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
      <span class="na">channel</span><span class="p">:</span> <span class="nx">user</span><span class="p">,</span>
      <span class="na">text</span><span class="p">:</span> <span class="nx">msg</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="publishing-views">Publishing views to App Home</h3>

            <div class="section-content">
  <p><a href="https://api.slack.com/surfaces/tabs/using">Home tabs</a> are customizable surfaces accessible via the sidebar and search that allow apps to display views on a per-user basis. After enabling App Home within your app configuration, home tabs can be published and updated by passing a <code class="language-plaintext highlighter-rouge">user_id</code> and <a href="https://api.slack.com/reference/block-kit/views">view payload</a> to the <a href="https://api.slack.com/methods/views.publish"><code class="language-plaintext highlighter-rouge">views.publish</code></a> method.</p>

  <p>You can subscribe to the <a href="https://api.slack.com/events/app_home_opened"><code class="language-plaintext highlighter-rouge">app_home_opened</code></a> event to listen for when users open your App Home.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Listen for users opening your App Home</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="dl">'</span><span class="s1">app_home_opened</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Call views.publish with the built-in client</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">views</span><span class="p">.</span><span class="nx">publish</span><span class="p">({</span>
      <span class="c1">// Use the user ID associated with the event</span>
      <span class="na">user_id</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span>
      <span class="na">view</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// Home tabs must be enabled in your app configuration page under "App Home"</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">home</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">blocks</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">section</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mrkdwn</span><span class="dl">"</span><span class="p">,</span>
              <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">*Welcome home, &lt;@</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">user</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&gt; :house:*</span><span class="dl">"</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">section</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mrkdwn</span><span class="dl">"</span><span class="p">,</span>
              <span class="na">text</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Learn how home tabs can be more useful and interactive &lt;https://api.slack.com/surfaces/tabs/using|*in the documentation*&gt;.</span><span class="dl">"</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="options">Listening and responding to options</h3>

            <div class="section-content">
  <p>The <code class="language-plaintext highlighter-rouge">options()</code> method listens for incoming option request payloads from Slack. <a href="#action-listening">Similar to <code class="language-plaintext highlighter-rouge">action()</code></a>,
an <code class="language-plaintext highlighter-rouge">action_id</code> or constraints object is required.</p>

  <p>While it‚Äôs recommended to use <code class="language-plaintext highlighter-rouge">action_id</code> for <code class="language-plaintext highlighter-rouge">external_select</code> menus, dialogs do not yet support Block Kit so you‚Äôll have to 
use the constraints object to filter on a <code class="language-plaintext highlighter-rouge">callback_id</code>.</p>

  <p>To respond to options requests, you‚Äôll need to <code class="language-plaintext highlighter-rouge">ack()</code> with valid options. Both <a href="https://api.slack.com/reference/messaging/block-elements#external-select">external select response examples</a> and <a href="https://api.slack.com/dialogs#dynamic_select_elements_external">dialog response examples</a> can be found on our API site.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Example of responding to an external_select options request</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">options</span><span class="p">(</span><span class="dl">'</span><span class="s1">external_action</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">ack</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Get information specific to a team or channel</span>
  <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">team</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="c1">// Collect information in options array to send in Slack ack response</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">result</span> <span class="k">of</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">plain_text</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">label</span>
        <span class="p">},</span>
        <span class="na">value</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">value</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">await</span> <span class="nx">ack</span><span class="p">({</span>
      <span class="na">options</span><span class="p">:</span> <span class="nx">options</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="authenticating-oauth">Authenticating with OAuth</h3>

            <div class="section-content">
  <p>To prepare your Slack app for distribution, you will need to enable Bolt OAuth and store installation information securely. Bolt supports OAuth and will handle the rest of the work; this includes setting up OAuth routes, state verification, and passing your app an installation object which you must store.</p>

  <p>To enable OAuth, you must provide:</p>
  <ul>
    <li>
<code class="language-plaintext highlighter-rouge">clientId</code>, <code class="language-plaintext highlighter-rouge">clientSecret</code>, <code class="language-plaintext highlighter-rouge">stateSecret</code> and <code class="language-plaintext highlighter-rouge">scopes</code> <em>(required)</em>
</li>
    <li>An <code class="language-plaintext highlighter-rouge">installationStore</code> option with handlers that store and fetch installations to your database <em>(optional, strongly recommended in production)</em>
</li>
  </ul>

  <hr>

  <h5 id="development-and-testing">Development and Testing</h5>

  <p>We‚Äôve provided a default implementation of the <code class="language-plaintext highlighter-rouge">installationStore</code>  <code class="language-plaintext highlighter-rouge">FileInstallationStore</code> which you can use during app development and testing.</p>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">FileInstallationStore</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/oauth</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span><span class="p">,</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_CLIENT_ID</span><span class="p">,</span>
  <span class="na">clientSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_CLIENT_SECRET</span><span class="p">,</span>
  <span class="na">stateSecret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">my-state-secret</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">scopes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">channels:history</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">chat:write</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">commands</span><span class="dl">'</span><span class="p">],</span>
  <span class="na">installationStore</span><span class="p">:</span> <span class="k">new</span> <span class="nx">FileInstallationStore</span><span class="p">(),</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>
  <p><img class="emoji" title=":warning:" alt=":warning:" src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png" height="20" width="20"> This is <strong><em>not</em></strong> recommended for use in production - you should implement your own production store. Please see the example code to the right and <a href="https://github.com/slackapi/bolt-js/tree/main/examples/oauth">our other examples</a>.</p>

  <hr>

  <h5 id="installing-your-app">Installing your App</h5>

  <ul>
    <li>
<strong>Initiating an installation</strong>: Bolt for JavaScript provides an <strong>Install Path</strong> <code class="language-plaintext highlighter-rouge">/slack/install</code> out-of-the-box. This endpoint returns a simple page with an <code class="language-plaintext highlighter-rouge">Add to Slack</code> button which initiates a direct install of your app (with a valid <code class="language-plaintext highlighter-rouge">state</code> parameter). An app hosted at <em>www.example.com</em> would serve the install page at <em>www.example.com/slack/install</em>.
      <ul>
        <li>üí° You can skip rendering the provided default webpage and navigate users directly to Slack authorize URL by setting<code class="language-plaintext highlighter-rouge">installerOptions.directInstall: true</code> in the <code class="language-plaintext highlighter-rouge">App</code> constructor (<a href="https://github.com/slackapi/bolt-js/blob/5b4d9ceb65e6bf5cf29dfa58268ea248e5466bfb/examples/oauth/app.js#L58-L64">example</a>).</li>
      </ul>
    </li>
    <li>
      <p><strong>Add to Slack</strong>: The <code class="language-plaintext highlighter-rouge">Add to Slack</code> button initiates the OAuth process with Slack. After users have clicked Allow to grant your app permissions, Slack will call your app‚Äôs <strong>Redirect URI</strong> (provided out-of-the-box), and prompt users to <strong>Open Slack</strong>. See the <strong>Redirect URI</strong> section below for customization options.</p>
    </li>
    <li>
      <p><strong>Open Slack</strong>: After users <strong>Open Slack</strong>, and here after as your app processes events from Slack, your provided <code class="language-plaintext highlighter-rouge">installationStore</code>‚Äôs <code class="language-plaintext highlighter-rouge">fetchInstallation</code> and <code class="language-plaintext highlighter-rouge">storeInstallation</code> handlers will execute. See the <strong>Installation Object</strong> section below for more detail on arguments passed to those handlers.</p>
    </li>
    <li>
      <p>If you need additional authorizations (user tokens) from users inside a team when your app is already installed, or have a reason to dynamically generate an install URL, manually instantiate an <code class="language-plaintext highlighter-rouge">ExpressReceiver</code>, assign the instance to a variable named <code class="language-plaintext highlighter-rouge">receiver</code>, and then call <code class="language-plaintext highlighter-rouge">receiver.installer.generateInstallUrl()</code>. Read more about <code class="language-plaintext highlighter-rouge">generateInstallUrl()</code> in the <a href="https://slack.dev/node-slack-sdk/oauth#generating-an-installation-url">OAuth docs</a>.</p>
    </li>
    <li>üí° Bolt for JavaScript does not support OAuth for <a href="#receiver">custom receivers</a>. If you‚Äôre implementing a custom receiver, you can use our <a href="https://slack.dev/node-slack-sdk/oauth#slack-oauth">Slack OAuth library</a>, which is what Bolt for JavaScript uses under the hood.</li>
  </ul>

  <hr>

  <h5 id="redirect-uri">Redirect URI</h5>
  <p>Bolt for JavaScript provides a <strong>Redirect URI Path</strong> <code class="language-plaintext highlighter-rouge">/slack/oauth_redirect</code>. Slack uses the Redirect URI to redirect users after they complete an app‚Äôs installation flow.</p>

  <p>üí° You will need to add the full <strong>Redirect URI</strong> including your app domain in your Slack app configuration settings under <strong>OAuth and Permissions</strong>, e.g. <code class="language-plaintext highlighter-rouge">https://example.com/slack/oauth_redirect</code>.</p>

  <p>To supply your own custom <strong>Redirect URI</strong>, you can set <code class="language-plaintext highlighter-rouge">redirectUri</code> in the App options and <code class="language-plaintext highlighter-rouge">installerOptions.redirectUriPath</code>. You must supply both, and the path must be consistent with the full URI.</p>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span><span class="p">,</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_CLIENT_ID</span><span class="p">,</span>
  <span class="na">clientSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_CLIENT_SECRET</span><span class="p">,</span>
  <span class="na">stateSecret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">my-state-secret</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">scopes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">chat:write</span><span class="dl">'</span><span class="p">],</span>
  <span class="na">redirectUri</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://example.com/slack/redirect</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// here</span>
  <span class="na">installerOptions</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">redirectUriPath</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/slack/redirect</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// and here!</span>
  <span class="p">},</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

  <hr>

  <h5 id="installation-object">Installation object</h5>
  <p>Bolt will pass your <code class="language-plaintext highlighter-rouge">installationStore</code>‚Äôs <code class="language-plaintext highlighter-rouge">storeInstallation</code> handler an <code class="language-plaintext highlighter-rouge">installation</code>. This can be a source of confusion for developers who aren‚Äôt sure what shape of object to expect. The <code class="language-plaintext highlighter-rouge">installation</code> object should resemble:</p>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
<td class="rouge-code"><pre><span class="p">{</span>
  <span class="nl">team</span><span class="p">:</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">T012345678</span><span class="dl">'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">example-team-name</span><span class="dl">'</span> <span class="p">},</span>
  <span class="nx">enterprise</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
  <span class="nx">user</span><span class="p">:</span> <span class="p">{</span> <span class="nl">token</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">scopes</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">U01234567</span><span class="dl">'</span> <span class="p">},</span>
  <span class="nx">tokenType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">bot</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">isEnterpriseInstall</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">appId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">A01234567</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">authVersion</span><span class="p">:</span> <span class="dl">'</span><span class="s1">v2</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">bot</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">scopes</span><span class="p">:</span> <span class="p">[</span>
      <span class="dl">'</span><span class="s1">chat:write</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="nx">token</span><span class="p">:</span> <span class="dl">'</span><span class="s1">xoxb-244493-28*********-********************</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">userId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">U012345678</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">B01234567</span><span class="dl">'</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>
  <p>Bolt will pass your <code class="language-plaintext highlighter-rouge">fetchInstallation</code> and <code class="language-plaintext highlighter-rouge">deleteInstallation</code> handlers an <code class="language-plaintext highlighter-rouge">installQuery</code> object:</p>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre><span class="p">{</span>
  <span class="nl">userId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">U012345678</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">isEnterpriseInstall</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">teamId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">T012345678</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">enterpriseId</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
  <span class="nx">conversationId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">D02345678</span><span class="dl">'</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

  <hr>

  <h5 id="org-wide-installation">Org-wide installation</h5>
  <p>To add support for <a href="https://api.slack.com/enterprise/apps">org-wide installations</a>, you will need Bolt for JavaScript version <code class="language-plaintext highlighter-rouge">3.0.0</code> or later. Make sure you have enabled org-wide installation in your app configuration settings under <strong>Org Level Apps</strong>.</p>

  <p>Installing an <a href="https://api.slack.com/enterprise/apps">org-wide</a> app from admin pages requires additional configuration to work with Bolt. In that scenario, the recommended <code class="language-plaintext highlighter-rouge">state</code> parameter is not supplied. Bolt will try to verify <code class="language-plaintext highlighter-rouge">state</code> and stop the installation from progressing.</p>

  <p>You may disable state verification in Bolt by setting the <code class="language-plaintext highlighter-rouge">stateVerification</code> option to false. See the example setup below:</p>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span><span class="p">,</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_CLIENT_ID</span><span class="p">,</span>
  <span class="na">clientSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_CLIENT_SECRET</span><span class="p">,</span>
  <span class="na">scopes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">chat:write</span><span class="dl">'</span><span class="p">],</span>
  <span class="na">installerOptions</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">stateVerification</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

  <p>To learn more about the OAuth installation flow with Slack, <a href="https://api.slack.com/authentication/oauth-v2">read the API documentation</a>.</p>

</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">database</span> <span class="o">=</span> <span class="p">{</span>
  <span class="k">async</span> <span class="kd">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{},</span>
  <span class="k">async</span> <span class="k">delete</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{},</span>
  <span class="k">async</span> <span class="kd">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span><span class="p">,</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_CLIENT_ID</span><span class="p">,</span>
  <span class="na">clientSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_CLIENT_SECRET</span><span class="p">,</span>
  <span class="na">stateSecret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">my-secret</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">scopes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">chat:write</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">commands</span><span class="dl">'</span><span class="p">],</span>
  <span class="na">installationStore</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">storeInstallation</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">installation</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Bolt will pass your handler an installation object</span>
      <span class="c1">// Change the lines below so they save to your database</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">installation</span><span class="p">.</span><span class="nx">isEnterpriseInstall</span> <span class="o">&amp;&amp;</span> <span class="nx">installation</span><span class="p">.</span><span class="nx">enterprise</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle storing org-wide app installation</span>
        <span class="k">return</span> <span class="k">await</span> <span class="nx">database</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">installation</span><span class="p">.</span><span class="nx">enterprise</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">installation</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">installation</span><span class="p">.</span><span class="nx">team</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// single team app installation</span>
        <span class="k">return</span> <span class="k">await</span> <span class="nx">database</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">installation</span><span class="p">.</span><span class="nx">team</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">installation</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed saving installation data to installationStore</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">fetchInstallation</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">installQuery</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Bolt will pass your handler an installQuery object</span>
      <span class="c1">// Change the lines below so they fetch from your database</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">installQuery</span><span class="p">.</span><span class="nx">isEnterpriseInstall</span> <span class="o">&amp;&amp;</span> <span class="nx">installQuery</span><span class="p">.</span><span class="nx">enterpriseId</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle org wide app installation lookup</span>
        <span class="k">return</span> <span class="k">await</span> <span class="nx">database</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">installQuery</span><span class="p">.</span><span class="nx">enterpriseId</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">installQuery</span><span class="p">.</span><span class="nx">teamId</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// single team app installation lookup</span>
        <span class="k">return</span> <span class="k">await</span> <span class="nx">database</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">installQuery</span><span class="p">.</span><span class="nx">teamId</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed fetching installation</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">deleteInstallation</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">installQuery</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Bolt will pass your handler  an installQuery object</span>
      <span class="c1">// Change the lines below so they delete from your database</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">installQuery</span><span class="p">.</span><span class="nx">isEnterpriseInstall</span> <span class="o">&amp;&amp;</span> <span class="nx">installQuery</span><span class="p">.</span><span class="nx">enterpriseId</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// org wide app installation deletion</span>
        <span class="k">return</span> <span class="k">await</span> <span class="nx">database</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">installQuery</span><span class="p">.</span><span class="nx">enterpriseId</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">installQuery</span><span class="p">.</span><span class="nx">teamId</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// single team app installation deletion</span>
        <span class="k">return</span> <span class="k">await</span> <span class="nx">database</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">installQuery</span><span class="p">.</span><span class="nx">teamId</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to delete installation</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<details class="secondary-wrapper">
  <summary class="section-head">
    <h4 class="section-head">Customizing OAuth defaults</h4>
  </summary>

  <div class="secondary-content">
    <p>We provide several options for customizing default OAuth using the <code class="language-plaintext highlighter-rouge">installerOptions</code> object, which can be passed in during the initialization of <code class="language-plaintext highlighter-rouge">App</code>. You can override the following:</p>

    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">authVersion</code>: Used to toggle between new Slack Apps and Classic Slack Apps</li>
      <li>
<code class="language-plaintext highlighter-rouge">metadata</code>: Used to pass around session related information</li>
      <li>
<code class="language-plaintext highlighter-rouge">installPath</code>: Override default path for ‚ÄúAdd to Slack‚Äù button</li>
      <li>
<code class="language-plaintext highlighter-rouge">redirectUriPath</code>: This relative path must match the <code class="language-plaintext highlighter-rouge">redirectUri</code> provided in the App options</li>
      <li>
<code class="language-plaintext highlighter-rouge">callbackOptions</code>: Provide custom success and failure pages at the end of the OAuth flow</li>
      <li>
<code class="language-plaintext highlighter-rouge">stateStore</code>: Provide a custom state store instead of using the built in <code class="language-plaintext highlighter-rouge">ClearStateStore</code>
</li>
      <li>
<code class="language-plaintext highlighter-rouge">userScopes</code>: Array of user scopes needed when the user installs the app, similar to <code class="language-plaintext highlighter-rouge">scopes</code> attribute at the parent level.</li>
    </ul>

  </div>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span><span class="p">,</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_CLIENT_ID</span><span class="p">,</span>
  <span class="na">clientSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_CLIENT_SECRET</span><span class="p">,</span>
  <span class="na">scopes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">channels:read</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">groups:read</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">channels:manage</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">chat:write</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">incoming-webhook</span><span class="dl">'</span><span class="p">],</span>
  <span class="na">installerOptions</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">authVersion</span><span class="p">:</span> <span class="dl">'</span><span class="s1">v1</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// default  is 'v2', 'v1' is used for classic slack apps</span>
      <span class="na">metadata</span><span class="p">:</span> <span class="dl">'</span><span class="s1">some session data</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">installPath</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/slack/installApp</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">redirectUriPath</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/slack/redirect</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">userScopes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">chat:write</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">callbackOptions</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">success</span><span class="p">:</span> <span class="p">(</span><span class="nx">installation</span><span class="p">,</span> <span class="nx">installOptions</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="c1">// Do custom success logic here</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">successful!</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">},</span> 
        <span class="na">failure</span><span class="p">:</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">installOptions</span> <span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="c1">// Do custom failure logic here</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">failure</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="na">stateStore</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// Do not need to provide a `stateSecret` when passing in a stateStore</span>
        <span class="c1">// generateStateParam's first argument is the entire InstallUrlOptions object which was passed into generateInstallUrl method</span>
        <span class="c1">// the second argument is a date object</span>
        <span class="c1">// the method is expected to return a string representing the state</span>
        <span class="na">generateStateParam</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">installUrlOptions</span><span class="p">,</span> <span class="nx">date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="c1">// generate a random string to use as state in the URL</span>
          <span class="kd">const</span> <span class="nx">randomState</span> <span class="o">=</span> <span class="nx">randomStringGenerator</span><span class="p">();</span>
          <span class="c1">// save installOptions to cache/db</span>
          <span class="k">await</span> <span class="nx">myDB</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">randomState</span><span class="p">,</span> <span class="nx">installUrlOptions</span><span class="p">);</span>
          <span class="c1">// return a state string that references saved options in DB</span>
          <span class="k">return</span> <span class="nx">randomState</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="c1">// verifyStateParam's first argument is a date object and the second argument is a string representing the state</span>
        <span class="c1">// verifyStateParam is expected to return an object representing installUrlOptions</span>
        <span class="na">verifyStateParam</span><span class="p">:</span>  <span class="k">async</span> <span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="c1">// fetch saved installOptions from DB using state reference</span>
          <span class="kd">const</span> <span class="nx">installUrlOptions</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">myDB</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">randomState</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">installUrlOptions</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

</details>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="socket-mode">Using Socket Mode</h3>

            <div class="section-content">
  <p><a href="https://api.slack.com/socket-mode">Socket Mode</a> allows your app to connect and receive data from Slack via a WebSocket connection. To handle the connection, Bolt for JavaScript includes a <code class="language-plaintext highlighter-rouge">SocketModeReceiver</code> (in <code class="language-plaintext highlighter-rouge">@slack/bolt@3.0.0</code> and higher). Before using Socket Mode, be sure to enable it within your app configuration.</p>

  <p>To use the <code class="language-plaintext highlighter-rouge">SocketModeReceiver</code>, just pass in <code class="language-plaintext highlighter-rouge">socketMode:true</code> and <code class="language-plaintext highlighter-rouge">appToken:YOUR_APP_TOKEN</code> when initializing <code class="language-plaintext highlighter-rouge">App</code>. You can get your App Level Token in your app configuration under the <strong>Basic Information</strong> section.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BOT_TOKEN</span><span class="p">,</span>
  <span class="na">socketMode</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">appToken</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">APP_TOKEN</span><span class="p">,</span>
<span class="p">});</span>

<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚ö°Ô∏è Bolt app started</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})();</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<details class="secondary-wrapper">
  <summary class="section-head">
    <h4 class="section-head">Custom SocketMode Receiver</h4>
  </summary>

  <div class="secondary-content">
    <p>You can define a custom <code class="language-plaintext highlighter-rouge">SocketModeReceiver</code> by importing it from <code class="language-plaintext highlighter-rouge">@slack/bolt</code>.</p>

  </div>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span><span class="p">,</span> <span class="nx">SocketModeReceiver</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">socketModeReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SocketModeReceiver</span><span class="p">({</span>
  <span class="na">appToken</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">APP_TOKEN</span><span class="p">,</span>

  <span class="c1">// enable the following if you want to use OAuth</span>
  <span class="c1">// clientId: process.env.CLIENT_ID,</span>
  <span class="c1">// clientSecret: process.env.CLIENT_SECRET,</span>
  <span class="c1">// stateSecret: 'my-state-secret',</span>
  <span class="c1">// scopes: ['channels:read', 'chat:write', 'app_mentions:read', 'channels:manage', 'commands'],</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">receiver</span><span class="p">:</span> <span class="nx">socketModeReceiver</span><span class="p">,</span>
  <span class="c1">// disable token line below if using OAuth</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BOT_TOKEN</span>
<span class="p">});</span>

<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚ö°Ô∏è Bolt app started</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})();</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

</details>


            <hr>
          </div>
          
        </div>

        <div id="advanced">
           
          <div class="section-wrapper">
            <h3 id="error-handling">Handling errors</h3>

            <div class="section-content">
  <p><em>Note: Since v2, error handling has improved! View the <a href="https://slack.dev/bolt/tutorial/migration-v2">migration guide for V2</a> to learn about the changes.</em></p>

  <p>If an error occurs in a listener, it‚Äôs recommended you handle it directly with a <code class="language-plaintext highlighter-rouge">try</code>/<code class="language-plaintext highlighter-rouge">catch</code>. However, there still may be cases where errors slip through the cracks. By default, these errors will be logged to the console. To handle them yourself, you can attach a global error handler to your app with the <code class="language-plaintext highlighter-rouge">app.error(fn)</code> method.</p>

  <p>You can also define more focussed and specific error handlers for a variety of error paths directly on the <code class="language-plaintext highlighter-rouge">HTTPReceiver</code>:</p>

  <ul>
    <li>
<code class="language-plaintext highlighter-rouge">dispatchErrorHandler</code>: triggered if an incoming request is to an unexpected path.</li>
    <li>
<code class="language-plaintext highlighter-rouge">processEventErrorHandler</code>: triggered when processing a request (i.e. middleware, authorization) throws an exception.</li>
    <li>
<code class="language-plaintext highlighter-rouge">unhandledRequestHandler</code>: triggered when a request from Slack goes unacknowledged.</li>
    <li>
<code class="language-plaintext highlighter-rouge">unhandledRequestTimeoutMillis</code>: the amount of time in milliseconds to wait for request acknowledgement from the application before triggering the <code class="language-plaintext highlighter-rouge">unhandledRequestHandler</code>. Default is <code class="language-plaintext highlighter-rouge">3001</code>.</li>
  </ul>

  <p><em>NOTE</em>: It is imperative that any custom Error Handlers defined in your app respond to the underlying Slack request that led to the error, using <code class="language-plaintext highlighter-rouge">response.writeHead()</code> to set the HTTP status code of the response and <code class="language-plaintext highlighter-rouge">response.end()</code> to dispatch the response back to Slack. See the example for details.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td>
<td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">App</span><span class="p">,</span> <span class="nx">HTTPReceiver</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">receiver</span><span class="p">:</span> <span class="k">new</span> <span class="nx">HTTPReceiver</span><span class="p">({</span>
    <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span><span class="p">,</span>
    <span class="c1">// more specific, focussed error handlers</span>
    <span class="na">dispatchErrorHandler</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">logger</span><span class="p">,</span> <span class="nx">response</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`dispatch error: </span><span class="p">${</span><span class="nx">error</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">Something is wrong!</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="na">processEventErrorHandler</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">logger</span><span class="p">,</span> <span class="nx">response</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`processEvent error: </span><span class="p">${</span><span class="nx">error</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="c1">// acknowledge it anyway!</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="na">unhandledRequestHandler</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">logger</span><span class="p">,</span> <span class="nx">response</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">Acknowledging this incoming request because 2 seconds already passed...</span><span class="dl">'</span><span class="p">);</span>
      <span class="c1">// acknowledge it anyway!</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="na">unhandledRequestTimeoutMillis</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="c1">// the default is 3001</span>
  <span class="p">}),</span>
<span class="p">});</span>

<span class="c1">// A more generic, global error handler</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Check the details of the error to handle cases where you should retry sending a message or stop the app</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<details class="secondary-wrapper">
  <summary class="section-head">
    <h4 class="section-head">Accessing more data in the error handler</h4>
  </summary>

  <div class="secondary-content">
    <p>There may be cases where you need to log additional data from a request in the global error handler. Or you may simply wish to have access to the <code class="language-plaintext highlighter-rouge">logger</code> you‚Äôve passed into Bolt.</p>

    <p>Starting with version 3.8.0, when passing <code class="language-plaintext highlighter-rouge">extendedErrorHandler: true</code> to the constructor, the error handler will receive an object with <code class="language-plaintext highlighter-rouge">error</code>, <code class="language-plaintext highlighter-rouge">logger</code>, <code class="language-plaintext highlighter-rouge">context</code>, and the <code class="language-plaintext highlighter-rouge">body</code> of the request.</p>

    <p>It is recommended to check whether a property exists on the <code class="language-plaintext highlighter-rouge">context</code> or <code class="language-plaintext highlighter-rouge">body</code> objects before accessing its value, as the data available in the <code class="language-plaintext highlighter-rouge">body</code> object differs from event to event, and because errors can happen at any point in a request‚Äôs lifecycle (i.e. before a certain property of <code class="language-plaintext highlighter-rouge">context</code> has been set).</p>
  </div>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span><span class="p">,</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_BOT_TOKEN</span><span class="p">,</span>
  <span class="na">extendedErrorHandler</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="k">async</span> <span class="p">({</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">logger</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">body</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Log the error using the logger passed into Bolt</span>
  <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">teamId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do something with the team's ID for debugging purposes</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

</details>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="authorization">Authorization</h3>

            <div class="section-content">
  <p>Authorization is the process of deciding which Slack credentials (such as a bot token) should be available while processing a specific incoming request.</p>

  <p>Custom apps installed on a single workspace can simply use the <code class="language-plaintext highlighter-rouge">token</code> option at the time of <code class="language-plaintext highlighter-rouge">App</code> initialization. However, when your app needs to handle several tokens, such as cases where it will be installed on multiple workspaces or needs access to more than one user token, the <code class="language-plaintext highlighter-rouge">authorize</code> option should be used instead. <b>If you‚Äôre using the <a href="#authenticating-oauth">built-in OAuth support</a> authorization is handled by default, so you do not need to pass in an <code class="language-plaintext highlighter-rouge">authorize</code> option.</b></p>

  <p>The <code class="language-plaintext highlighter-rouge">authorize</code> option can be set to a function that takes an event source as its input, and should return a Promise for an object containing the authorized credentials. The source contains information about who and where the request is coming from by using properties like <code class="language-plaintext highlighter-rouge">teamId</code> (always available), <code class="language-plaintext highlighter-rouge">userId</code>, <code class="language-plaintext highlighter-rouge">conversationId</code>, and <code class="language-plaintext highlighter-rouge">enterpriseId</code>.</p>

  <p>The authorized credentials should also have a few specific properties: <code class="language-plaintext highlighter-rouge">botToken</code>, <code class="language-plaintext highlighter-rouge">userToken</code>, <code class="language-plaintext highlighter-rouge">botId</code> (required for an app to ignore messages from itself), and <code class="language-plaintext highlighter-rouge">botUserId</code>. You can also include any other properties you‚Äôd like to make available on the <a href="#context"><code class="language-plaintext highlighter-rouge">context</code></a> object.</p>

  <p>You should always provide either one or both of the <code class="language-plaintext highlighter-rouge">botToken</code> and <code class="language-plaintext highlighter-rouge">userToken</code> properties. At least one of them is necessary to make helpers like <code class="language-plaintext highlighter-rouge">say()</code> work. If they are both given, then <code class="language-plaintext highlighter-rouge">botToken</code> will take precedence.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span> <span class="na">authorize</span><span class="p">:</span> <span class="nx">authorizeFn</span><span class="p">,</span> <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span> <span class="p">});</span>

<span class="c1">// NOTE: This is for demonstration purposes only.</span>
<span class="c1">// All sensitive data should be stored in a secure database</span>
<span class="c1">// Assuming this app only uses bot tokens, the following object represents a model for storing the credentials as the app is installed into multiple workspaces.</span>

<span class="kd">const</span> <span class="nx">installations</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="na">enterpriseId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">E1234A12AB</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">teamId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">T12345</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">botToken</span><span class="p">:</span> <span class="dl">'</span><span class="s1">xoxb-123abc</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">botId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">B1251</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">botUserId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">U12385</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">teamId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">T77712</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">botToken</span><span class="p">:</span> <span class="dl">'</span><span class="s1">xoxb-102anc</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">botId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">B5910</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">botUserId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">U1239</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">];</span>

<span class="kd">const</span> <span class="nx">authorizeFn</span> <span class="o">=</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">teamId</span><span class="p">,</span> <span class="nx">enterpriseId</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Fetch team info from database</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">team</span> <span class="k">of</span> <span class="nx">installations</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Check for matching teamId and enterpriseId in the installations array</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">team</span><span class="p">.</span><span class="nx">teamId</span> <span class="o">===</span> <span class="nx">teamId</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">team</span><span class="p">.</span><span class="nx">enterpriseId</span> <span class="o">===</span> <span class="nx">enterpriseId</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// This is a match. Use these installation credentials.</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="c1">// You could also set userToken instead</span>
        <span class="na">botToken</span><span class="p">:</span> <span class="nx">team</span><span class="p">.</span><span class="nx">botToken</span><span class="p">,</span>
        <span class="na">botId</span><span class="p">:</span> <span class="nx">team</span><span class="p">.</span><span class="nx">botId</span><span class="p">,</span>
        <span class="na">botUserId</span><span class="p">:</span> <span class="nx">team</span><span class="p">.</span><span class="nx">botUserId</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">No matching authorizations</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="token-rotation">Token rotation</h3>

            <div class="section-content">
  <p>Supported in Bolt for JavaScript as of v3.5.0, token rotation provides an extra layer of security for your access tokens and is defined by the <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-10.4">OAuth V2 RFC</a>.</p>

  <p>Instead of an access token representing an existing installation of your Slack app indefinitely, with token rotation enabled, access tokens expire. A refresh token acts as a long-lived way to refresh your access tokens.</p>

  <p>Bolt for JavaScript supports and will handle token rotation automatically so long as the <a href="https://slack.dev/bolt-js/concepts#authenticating-oauth">built-in OAuth</a> functionality is used.</p>

  <p>For more information about token rotation, please see the <a href="https://api.slack.com/authentication/rotation">documentation</a>.</p>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="conversation-store">Conversation stores</h3>

            <div class="section-content">
  <p>Bolt for JavaScript includes support for a store, which sets and retrieves state related to a conversation. Conversation stores have two methods:</p>
  <ul>
    <li>
<code class="language-plaintext highlighter-rouge">set()</code> modifies conversation state. <code class="language-plaintext highlighter-rouge">set()</code> requires a <code class="language-plaintext highlighter-rouge">conversationId</code> of type string, <code class="language-plaintext highlighter-rouge">value</code> of any type, and an optional <code class="language-plaintext highlighter-rouge">expiresAt</code> of type number. <code class="language-plaintext highlighter-rouge">set()</code> returns a <code class="language-plaintext highlighter-rouge">Promise</code>.</li>
    <li>
<code class="language-plaintext highlighter-rouge">get()</code> fetches conversation state from the store. <code class="language-plaintext highlighter-rouge">get()</code> requires a <code class="language-plaintext highlighter-rouge">conversationId</code> of type string and returns a Promise with the conversation‚Äôs state.</li>
  </ul>

  <p><code class="language-plaintext highlighter-rouge">conversationContext()</code> is a built-in <a href="#global-middleware">global middleware</a> that allows conversations to be updated by other middleware. When receiving an event, middleware functions can use <code class="language-plaintext highlighter-rouge">context.updateConversation()</code> to set state and <code class="language-plaintext highlighter-rouge">context.conversation</code> to retrieve it.</p>

  <p>The built-in conversation store simply stores conversation state in memory. While this is sufficient for some situations, if there is more than one instance of your app running, the state will not be shared among the processes so you‚Äôll want to implement a conversation store that fetches conversation state from a database.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="nx">token</span><span class="p">,</span>
  <span class="nx">signingSecret</span><span class="p">,</span>
  <span class="c1">// It's more likely that you'd create a class for a convo store</span>
  <span class="na">convoStore</span><span class="p">:</span> <span class="k">new</span> <span class="nx">simpleConvoStore</span><span class="p">()</span>
<span class="p">});</span>

<span class="c1">// A simple implementation of a conversation store with a Firebase-like database</span>
<span class="kd">class</span> <span class="nx">simpleConvoStore</span> <span class="p">{</span>
  <span class="kd">set</span><span class="p">(</span><span class="nx">conversationId</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">expiresAt</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Returns a Promise</span>
    <span class="k">return</span> <span class="nx">db</span><span class="p">().</span><span class="nx">ref</span><span class="p">(</span><span class="dl">'</span><span class="s1">conversations/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">conversationId</span><span class="p">).</span><span class="kd">set</span><span class="p">({</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">expiresAt</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">get</span><span class="p">(</span><span class="nx">conversationId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Returns a Promise</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">db</span><span class="p">().</span><span class="nx">ref</span><span class="p">(</span><span class="dl">'</span><span class="s1">conversations/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">conversationId</span><span class="p">).</span><span class="nx">once</span><span class="p">(</span><span class="dl">'</span><span class="s1">value</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">expiresAt</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">result</span><span class="p">.</span><span class="nx">expiresAt</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">db</span><span class="p">().</span><span class="nx">ref</span><span class="p">(</span><span class="dl">'</span><span class="s1">conversations/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">conversationId</span><span class="p">).</span><span class="k">delete</span><span class="p">();</span>

            <span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Conversation expired</span><span class="dl">'</span><span class="p">));</span>
          <span class="p">}</span>
          <span class="nx">resolve</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">// Conversation not found</span>
          <span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Conversation not found</span><span class="dl">'</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="global-middleware">Global middleware</h3>

            <div class="section-content">
  <p>Global middleware is run for all incoming requests before any <a href="#listener-middleware">listener middleware</a>. You can add any number of global middleware to your app by utilizing <code class="language-plaintext highlighter-rouge">app.use(fn)</code>. The middleware function <code class="language-plaintext highlighter-rouge">fn</code> is called with the same arguments as listeners and an additional <code class="language-plaintext highlighter-rouge">next</code> function.</p>

  <p>Both global and <a href="#listener-middleware">listener middleware</a> must call <code class="language-plaintext highlighter-rouge">await next()</code> to pass control of the execution chain to the next middleware, or call <code class="language-plaintext highlighter-rouge">throw</code> to pass an error back up the previously-executed middleware chain.</p>

  <p>As an example, let‚Äôs say your app should only respond to users identified with a corresponding internal authentication service (an SSO provider or LDAP, for example). You may define a global middleware that looks up a user record in the authentication service and errors if the user is not found.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Authentication middleware that associates incoming request with user in Acme identity provider</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">authWithAcme</span><span class="p">({</span> <span class="nx">payload</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">next</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">slackUserId</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">helpChannelId</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">C12345</span><span class="dl">'</span><span class="p">;</span>

  <span class="c1">// Assume we have a function that accepts a Slack user ID to find user details from Acme</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Assume we have a function that can take a Slack user ID as input to find user details from the provider</span>
    <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">acme</span><span class="p">.</span><span class="nx">lookupBySlackId</span><span class="p">(</span><span class="nx">slackUserId</span><span class="p">);</span>
      
    <span class="c1">// When the user lookup is successful, add the user details to the context</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This user wasn't found in Acme. Send them an error and don't continue processing request</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Not Found</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">postEphemeral</span><span class="p">({</span>
          <span class="na">channel</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">channel</span><span class="p">,</span>
          <span class="na">user</span><span class="p">:</span> <span class="nx">slackUserId</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="s2">`Sorry &lt;@</span><span class="p">${</span><span class="nx">slackUserId</span><span class="p">}</span><span class="s2">&gt;, you aren't registered in Acme. Please post in &lt;#</span><span class="p">${</span><span class="nx">helpChannelId</span><span class="p">}</span><span class="s2">&gt; for assistance.`</span>
        <span class="p">});</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Pass control to previous middleware (if any) or the global error handler</span>
    <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c1">// Pass control to the next middleware (if there are any) and the listener functions</span>
  <span class="c1">// Note: You probably don't want to call this inside a `try` block, or any middleware</span>
  <span class="c1">//       after this one that throws will be caught by it. </span>
  <span class="k">await</span> <span class="nx">next</span><span class="p">();</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="listener-middleware">Listener middleware</h3>

            <div class="section-content">
  <p>Listener middleware is used for logic across many listener functions (but usually not all of them). They are added as arguments before the listener function in one of the built-in methods. You can add any number of listener middleware before the listener function.</p>

  <p>There‚Äôs a collection of <a href="reference#built-in-listener-middleware-functions">built-in listener middleware</a> that you can use like <code class="language-plaintext highlighter-rouge">directMention</code> which filters out any message that doesn‚Äôt directly @-mention your bot at the start of a message.</p>

  <p>But of course, you can write your own middleware for more custom functionality. While writing your own middleware, your function must call <code class="language-plaintext highlighter-rouge">await next()</code> to pass control to the next middleware, or <code class="language-plaintext highlighter-rouge">throw</code> to pass an error back up the previously-executed middleware chain.</p>

  <p>As an example, let‚Äôs say your listener should only deal with messages from humans. You can write a listener middleware that excludes any bot messages.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Listener middleware that filters out messages with 'bot_message' subtype</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">noBotMessages</span><span class="p">({</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">next</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">||</span> <span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">bot_message</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// The listener only receives messages from humans</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="nx">noBotMessages</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span>
  <span class="c1">// Handle only newly posted messages</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">===</span> <span class="kc">undefined</span>
    <span class="c1">// || message.subtype === 'bot_message'</span>
    <span class="o">||</span> <span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">file_share</span><span class="dl">'</span>
    <span class="o">||</span> <span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">thread_broadcast</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`(MSG) User: </span><span class="p">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">user</span><span class="p">}</span><span class="s2"> Message: </span><span class="p">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">));</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="context">Adding context</h3>

            <div class="section-content">
  <p>All listeners have access to a <code class="language-plaintext highlighter-rouge">context</code> object, which can be used to enrich requests with additional information. For example, perhaps you want to add user information from a third party system or add temporary state for the next middleware in the chain.</p>

  <p><code class="language-plaintext highlighter-rouge">context</code> is just an object, so you can add to it by setting it to a modified version of itself.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td>
<td class="rouge-code"><pre><span class="k">async</span> <span class="kd">function</span> <span class="nx">addTimezoneContext</span><span class="p">({</span> <span class="nx">payload</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">next</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">info</span><span class="p">({</span>
    <span class="na">user</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">user_id</span><span class="p">,</span>
    <span class="na">include_locale</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">});</span>

  <span class="c1">// Add user's timezone context</span>
  <span class="nx">context</span><span class="p">.</span><span class="nx">tz_offset</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">tz_offset</span><span class="p">;</span>

  <span class="c1">// Pass control to the next middleware function</span>
  <span class="k">await</span> <span class="nx">next</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="dl">'</span><span class="s1">/request</span><span class="dl">'</span><span class="p">,</span> <span class="nx">addTimezoneContext</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">command</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Acknowledge command request</span>
  <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>
  <span class="c1">// Get local hour of request</span>
  <span class="kd">const</span> <span class="nx">localHour</span> <span class="o">=</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">UTC</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">tz_offset</span><span class="p">).</span><span class="nx">getHours</span><span class="p">();</span>

  <span class="c1">// Request channel ID</span>
  <span class="kd">const</span> <span class="nx">requestChannel</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">C12345</span><span class="dl">'</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">requestText</span> <span class="o">=</span> <span class="s2">`:large_blue_circle: *New request from &lt;@</span><span class="p">${</span><span class="nx">command</span><span class="p">.</span><span class="nx">user_id</span><span class="p">}</span><span class="s2">&gt;*: </span><span class="p">${</span><span class="nx">command</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

  <span class="c1">// If request not inbetween 9AM and 5PM, send request tomorrow</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">localHour</span> <span class="o">&gt;</span> <span class="mi">17</span> <span class="o">||</span> <span class="nx">localHour</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Assume function exists to get local tomorrow 9AM from offset</span>
    <span class="kd">const</span> <span class="nx">localTomorrow</span> <span class="o">=</span> <span class="nx">getLocalTomorrow</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">tz_offset</span><span class="p">);</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// Schedule message</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">scheduleMessage</span><span class="p">({</span>
        <span class="na">channel</span><span class="p">:</span> <span class="nx">requestChannel</span><span class="p">,</span>
        <span class="na">text</span><span class="p">:</span> <span class="nx">requestText</span><span class="p">,</span>
        <span class="na">post_at</span><span class="p">:</span> <span class="nx">localTomorrow</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// Post now</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
        <span class="na">channel</span><span class="p">:</span> <span class="nx">requestChannel</span><span class="p">,</span>
        <span class="na">text</span><span class="p">:</span> <span class="nx">requestText</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="deferring-initialization">Deferring App initialization</h3>

            <div class="section-content">
  <p>Bolt offers a way to defer full initialization via the <code class="language-plaintext highlighter-rouge">deferInitialization</code> option and to call the equivalent <code class="language-plaintext highlighter-rouge">App#init()</code> in your code, putting more control over asynchronous execution required for initialization into your hands as the developer.</p>

  <p><em>Note: If you call <code class="language-plaintext highlighter-rouge">start()</code> before <code class="language-plaintext highlighter-rouge">init()</code>, Bolt will raise an exception.</em></p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// deferInitialization is one of the options you can set in the constructor</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="nx">token</span><span class="p">,</span>
  <span class="nx">signingSecret</span><span class="p">,</span>
  <span class="na">deferInitialization</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>

<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Must call init() before start() within an async function</span>
    <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
    <span class="c1">// Now safe to call start()</span>
    <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})()</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="logging">Logging</h3>

            <div class="section-content">
  <p>By default, Bolt for JavaScript will log information from your app to the console. You can customize how much logging occurs by passing a <code class="language-plaintext highlighter-rouge">logLevel</code> in the constructor. The available log levels in order of most to least logs are <code class="language-plaintext highlighter-rouge">DEBUG</code>, <code class="language-plaintext highlighter-rouge">INFO</code>, <code class="language-plaintext highlighter-rouge">WARN</code>, and <code class="language-plaintext highlighter-rouge">ERROR</code>.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Import LogLevel from the package</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span><span class="p">,</span> <span class="nx">LogLevel</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Log level is one of the options you can set in the constructor</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="nx">token</span><span class="p">,</span>
  <span class="nx">signingSecret</span><span class="p">,</span>
  <span class="na">logLevel</span><span class="p">:</span> <span class="nx">LogLevel</span><span class="p">.</span><span class="nx">DEBUG</span><span class="p">,</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<details class="secondary-wrapper">
  <summary class="section-head">
    <h4 class="section-head">Sending log output somewhere besides the console</h4>
  </summary>

  <div class="secondary-content">
    <p>If you want to send logs to somewhere besides the console or want more control over the logger, you can implement a custom logger. A custom logger must implement specific methods (known as the <code class="language-plaintext highlighter-rouge">Logger</code> interface):</p>

    <table>
      <thead>
        <tr>
          <th>Method</th>
          <th>Parameters</th>
          <th>Return type</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">setLevel()</code></td>
          <td><code class="language-plaintext highlighter-rouge">level: LogLevel</code></td>
          <td><code class="language-plaintext highlighter-rouge">void</code></td>
        </tr>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">getLevel()</code></td>
          <td>None</td>
          <td>
<code class="language-plaintext highlighter-rouge">string</code> with value <code class="language-plaintext highlighter-rouge">error</code>, <code class="language-plaintext highlighter-rouge">warn</code>, <code class="language-plaintext highlighter-rouge">info</code>, or <code class="language-plaintext highlighter-rouge">debug</code>
</td>
        </tr>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">setName()</code></td>
          <td><code class="language-plaintext highlighter-rouge">name: string</code></td>
          <td><code class="language-plaintext highlighter-rouge">void</code></td>
        </tr>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">debug()</code></td>
          <td><code class="language-plaintext highlighter-rouge">...msgs: any[]</code></td>
          <td><code class="language-plaintext highlighter-rouge">void</code></td>
        </tr>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">info()</code></td>
          <td><code class="language-plaintext highlighter-rouge">...msgs: any[]</code></td>
          <td><code class="language-plaintext highlighter-rouge">void</code></td>
        </tr>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">warn()</code></td>
          <td><code class="language-plaintext highlighter-rouge">...msgs: any[]</code></td>
          <td><code class="language-plaintext highlighter-rouge">void</code></td>
        </tr>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">error()</code></td>
          <td><code class="language-plaintext highlighter-rouge">...msgs: any[]</code></td>
          <td><code class="language-plaintext highlighter-rouge">void</code></td>
        </tr>
      </tbody>
    </table>

    <p>A very simple custom logger might ignore the name and level, and write all messages to a file.</p>
  </div>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">createWriteStream</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">logWritable</span> <span class="o">=</span> <span class="nx">createWriteStream</span><span class="p">(</span><span class="dl">'</span><span class="s1">/var/my_log_file</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// Not shown: close this stream</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="nx">token</span><span class="p">,</span>
  <span class="nx">signingSecret</span><span class="p">,</span>
  <span class="c1">// Creating a logger as a literal object. It's more likely that you'd create a class.</span>
  <span class="na">logger</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">debug</span><span class="p">:</span> <span class="p">(...</span><span class="nx">msgs</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">logWritable</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">debug: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">msgs</span><span class="p">));</span> <span class="p">},</span>
    <span class="na">info</span><span class="p">:</span> <span class="p">(...</span><span class="nx">msgs</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">logWritable</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">info: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">msgs</span><span class="p">));</span> <span class="p">},</span>
    <span class="na">warn</span><span class="p">:</span> <span class="p">(...</span><span class="nx">msgs</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">logWritable</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">warn: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">msgs</span><span class="p">));</span> <span class="p">},</span>
    <span class="na">error</span><span class="p">:</span> <span class="p">(...</span><span class="nx">msgs</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">logWritable</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">msgs</span><span class="p">));</span> <span class="p">},</span>
    <span class="na">setLevel</span><span class="p">:</span> <span class="p">(</span><span class="nx">level</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">},</span>
    <span class="na">getLevel</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">},</span>
    <span class="na">setName</span><span class="p">:</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">},</span>
  <span class="p">},</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

</details>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="receiver">Customizing a receiver</h3>

            <div class="section-content">

  <h4 id="writing-a-custom-receiver">Writing a custom receiver</h4>

  <p>A receiver is responsible for handling and parsing any incoming requests from Slack then sending it to the app, so that the app can add context and pass the request to your listeners. Receivers must conform to the <a href="https://github.com/slackapi/bolt-js/blob/%40slack/bolt%403.13.1/src/types/receiver.ts#L27-L31">Receiver interface</a>:</p>

  <table>
    <thead>
      <tr>
        <th>Method</th>
        <th>Parameters</th>
        <th>Return type</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code class="language-plaintext highlighter-rouge">init()</code></td>
        <td><code class="language-plaintext highlighter-rouge">app: App</code></td>
        <td><code class="language-plaintext highlighter-rouge">unknown</code></td>
      </tr>
      <tr>
        <td><code class="language-plaintext highlighter-rouge">start()</code></td>
        <td>None</td>
        <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
      </tr>
      <tr>
        <td><code class="language-plaintext highlighter-rouge">stop()</code></td>
        <td>None</td>
        <td><code class="language-plaintext highlighter-rouge">Promise</code></td>
      </tr>
    </tbody>
  </table>

  <p><code class="language-plaintext highlighter-rouge">init()</code> is called after Bolt for JavaScript app is created. This method gives the receiver a reference to an <code class="language-plaintext highlighter-rouge">App</code> to store so that it can call:</p>
  <ul>
    <li>
<code class="language-plaintext highlighter-rouge">await app.processEvent(event)</code> whenever your app receives a request from Slack. It will throw if there is an unhandled error.</li>
  </ul>

  <p>To use a custom receiver, you can pass it into the constructor when initializing your Bolt for JavaScript app. Here is what a basic custom receiver might look like.</p>

  <p>For a more in-depth look at a receiver, <a href="https://github.com/slackapi/bolt-js/blob/master/src/receivers/ExpressReceiver.ts">read the source code for the built-in <code class="language-plaintext highlighter-rouge">ExpressReceiver</code></a></p>

  <hr>

  <h4 id="customizing-built-in-receivers">Customizing built-in receivers</h4>

  <p>The built-in <code class="language-plaintext highlighter-rouge">HTTPReceiver</code>, <code class="language-plaintext highlighter-rouge">ExpressReceiver</code>, <code class="language-plaintext highlighter-rouge">AwsLambdaReceiver</code> and <code class="language-plaintext highlighter-rouge">SocketModeReceiver</code> accept several configuration options. For a full list of options, see the <a href="/bolt-js/reference#receiver-options">Receiver options reference</a>.</p>

  <h5 id="extracting-custom-properties">Extracting custom properties</h5>

  <p>Use the <code class="language-plaintext highlighter-rouge">customPropertiesExtractor</code> option to extract custom properties from incoming events. The event type depends on the type of receiver you are using, e.g. HTTP requests for <code class="language-plaintext highlighter-rouge">HTTPReceiver</code>s, websocket messages for <code class="language-plaintext highlighter-rouge">SocketModeReceiver</code>s.</p>

  <p>This is particularly useful for extracting HTTP headers that you want to propagate to other services, for example, if you need to propagate a header for distributed tracing.</p>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span><span class="p">,</span> <span class="nx">HTTPReceiver</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_BOT_TOKEN</span><span class="p">,</span>
  <span class="na">receiver</span><span class="p">:</span> <span class="k">new</span> <span class="nx">HTTPReceiver</span><span class="p">({</span>
    <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span><span class="p">,</span>
    <span class="na">customPropertiesExtractor</span><span class="p">:</span> <span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">headers</span><span class="dl">"</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">bar</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}),</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">async</span> <span class="p">({</span> <span class="nx">logger</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">next</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Start your app</span>
  <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚ö°Ô∏è Bolt app is running!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})();</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>

  <p>You can find <a href="https://github.com/slackapi/bolt-js/tree/%40slack/bolt%403.13.1/examples/custom-properties">more examples of extracting custom properties</a> from different types of receivers here.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre></td>
<td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">createServer</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">express</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">SimpleReceiver</span>  <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">signingSecret</span><span class="p">,</span> <span class="nx">endpoints</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">server</span> <span class="o">=</span> <span class="nx">createServer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">endpoint</span> <span class="k">of</span> <span class="nx">endpoints</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">requestHandler</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bolt</span> <span class="o">=</span> <span class="nx">app</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">start</span><span class="p">(</span><span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">stop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">resolve</span><span class="p">();</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="c1">// This is a very simple implementation. Look at the ExpressReceiver source for more detail</span>
  <span class="k">async</span> <span class="nx">requestHandler</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">ackCalled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="c1">// Assume parseBody function exists to parse incoming requests</span>
    <span class="kd">const</span> <span class="nx">parsedReq</span> <span class="o">=</span> <span class="nx">parseBody</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">event</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">body</span><span class="p">:</span> <span class="nx">parsedReq</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
      <span class="c1">// Receivers are responsible for handling acknowledgements</span>
      <span class="c1">// `ack` should be prepared to be called multiple times and</span>
      <span class="c1">// possibly with `response` as an error</span>
      <span class="na">ack</span><span class="p">:</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ackCalled</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">response</span> <span class="k">instanceof</span> <span class="nb">Error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">send</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">''</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">ackCalled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">bolt</span><span class="p">.</span><span class="nx">processEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>


            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="custom-routes">Adding Custom HTTP routes</h3>

            <div class="section-content">
  <p>As of <code class="language-plaintext highlighter-rouge">v3.7.0</code>, custom HTTP routes can be easily added by passing in an array of routes as <code class="language-plaintext highlighter-rouge">customRoutes</code> when initializing <code class="language-plaintext highlighter-rouge">App</code>.</p>

  <p>Each <code class="language-plaintext highlighter-rouge">CustomRoute</code> object must contain three properties: <code class="language-plaintext highlighter-rouge">path</code>, <code class="language-plaintext highlighter-rouge">method</code>, and <code class="language-plaintext highlighter-rouge">handler</code>. <code class="language-plaintext highlighter-rouge">method</code>, which corresponds to the HTTP verb, can be either a string or an array of strings.</p>

  <p>Since <code class="language-plaintext highlighter-rouge">v3.13.0</code>, the default built-in receivers (<code class="language-plaintext highlighter-rouge">HTTPReceiver</code> and <code class="language-plaintext highlighter-rouge">SocketModeReceiver</code>) support dynamic route parameters like <a href="https://expressjs.com/en/guide/routing.html#route-parameters">Express.js does</a>. With this, you can capture positional values in the URL for use in your route‚Äôs handler via <code class="language-plaintext highlighter-rouge">req.params</code>.</p>

  <p>To determine what port the custom HTTP route will be available on locally, you can specify an <code class="language-plaintext highlighter-rouge">installerOptions.port</code> property in the <code class="language-plaintext highlighter-rouge">App</code> constructor. Otherwise, it will default to port <code class="language-plaintext highlighter-rouge">3000</code>.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Initialize Bolt app, using the default HTTPReceiver</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_BOT_TOKEN</span><span class="p">,</span>
  <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span><span class="p">,</span>
  <span class="na">customRoutes</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/health-check</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">method</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">handler</span><span class="p">:</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">`Things are going just fine at </span><span class="p">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">host</span><span class="p">}</span><span class="s2">!`</span><span class="p">);</span>
      <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/music/:genre</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">method</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">handler</span><span class="p">:</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">`Oh? </span><span class="p">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">genre</span><span class="p">}</span><span class="s2">? That slaps!`</span><span class="p">);</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">],</span>
  <span class="na">installerOptions</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">port</span><span class="p">:</span> <span class="mi">3001</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">});</span>

<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚ö°Ô∏è Bolt app started</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})();</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<details class="secondary-wrapper">
  <summary class="section-head">
    <h4 class="section-head">Custom ExpressReceiver routes</h4>
  </summary>

  <div class="secondary-content">
    <p>Adding custom HTTP routes is quite straightforward when using Bolt‚Äôs built-in ExpressReceiver. Since <code class="language-plaintext highlighter-rouge">v2.1.0</code>, <code class="language-plaintext highlighter-rouge">ExpressReceiver</code> added a <code class="language-plaintext highlighter-rouge">router</code> property, which exposes the Express <a href="http://expressjs.com/en/4x/api.html#router">Router</a> on which additional routes and middleware can be added.</p>
  </div>

  <div class="language-javascript highlighter-rouge">
    <div class="highlight">
      <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span><span class="p">,</span> <span class="nx">ExpressReceiver</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Create a Bolt Receiver</span>
<span class="kd">const</span> <span class="nx">receiver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ExpressReceiver</span><span class="p">({</span> <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span> <span class="p">});</span>

<span class="c1">// Create the Bolt App, using the receiver</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_BOT_TOKEN</span><span class="p">,</span>
  <span class="nx">receiver</span>
<span class="p">});</span>

<span class="c1">// Slack interactions are methods on app</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">client</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Do some slack-specific stuff here</span>
  <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(...);</span>
<span class="p">});</span>

<span class="c1">// Middleware methods execute on every web request</span>
<span class="nx">receiver</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">use</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Request time: </span><span class="p">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()}</span><span class="s2">`</span><span class="p">);</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// Other web requests are methods on receiver.router</span>
<span class="nx">receiver</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/secret-page</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// You're working with an express req and res now.</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">yay!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚ö°Ô∏è Bolt app started</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})();</span>
</pre></td>
</tr></tbody></table></code></pre>
    </div>
  </div>
</details>


            <hr>
          </div>
          
        </div>

        <div id="steps">
           
          <div class="section-wrapper">
            <h3 id="steps-overview">
              Overview of Workflow Steps for apps
              <span class="label-deprecated">
                Deprecated
              </span>
            </h3>
            <div class="section-content">

  <p><strong>‚ö†Ô∏è Workflow Steps from Apps are a deprecated feature, not to be confused with workflows that are part of the next generation Slack platform. They are not interchangeable features. We encourage those who are currently publishing Workflow Steps from apps to consider the new <a href="https://api.slack.com/automation">automation features</a> and <a href="https://api.slack.com/automation/functions/custom-bolt">custom steps for bolt</a>.</strong></p>

  <p>Workflow Steps from apps allow your app to create and process custom workflow steps that users can add using <a href="https://api.slack.com/workflows">Workflow Builder</a>.</p>

  <p>A workflow step is made up of three distinct user events:</p>

  <ul>
    <li>Adding or editing the step in a Workflow</li>
    <li>Saving or updating the step‚Äôs configuration</li>
    <li>The end user‚Äôs execution of the step</li>
  </ul>

  <p>All three events must be handled for a workflow step to function.</p>

  <p>Read more about workflow steps from apps in the <a href="https://api.slack.com/workflows/steps">API documentation</a>.</p>

</div>

            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="creating-steps">
              Creating workflow steps
              <span class="label-deprecated">
                Deprecated
              </span>
            </h3>
            <div class="section-content">

  <p>To create a workflow step, Bolt provides the <code class="language-plaintext highlighter-rouge">WorkflowStep</code> class.</p>

  <p>When instantiating a new <code class="language-plaintext highlighter-rouge">WorkflowStep</code>, pass in the step‚Äôs <code class="language-plaintext highlighter-rouge">callback_id</code> and a configuration object.</p>

  <p>The configuration object contains three properties: <code class="language-plaintext highlighter-rouge">edit</code>, <code class="language-plaintext highlighter-rouge">save</code>, and <code class="language-plaintext highlighter-rouge">execute</code>. Each of these properties must be a single callback or an array of callbacks. All callbacks have access to a <code class="language-plaintext highlighter-rouge">step</code> object that contains information about the workflow step event.</p>

  <p>After instantiating a <code class="language-plaintext highlighter-rouge">WorkflowStep</code>, you can pass it into <code class="language-plaintext highlighter-rouge">app.step()</code>. Behind the scenes, your app will listen and respond to the workflow step‚Äôs events using the callbacks provided in the configuration object.</p>

</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span><span class="p">,</span> <span class="nx">WorkflowStep</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Initiate the Bolt app as you normally would</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span><span class="p">,</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_BOT_TOKEN</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// Create a new WorkflowStep instance</span>
<span class="kd">const</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WorkflowStep</span><span class="p">(</span><span class="dl">'</span><span class="s1">add_task</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">edit</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">configure</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{},</span>
  <span class="na">save</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">update</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{},</span>
  <span class="na">execute</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">complete</span><span class="p">,</span> <span class="nx">fail</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{},</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">step</span><span class="p">(</span><span class="nx">ws</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="adding-editing-steps">
              Adding or editing workflow steps
              <span class="label-deprecated">
                Deprecated
              </span>
            </h3>
            <div class="section-content">

  <p>When a builder adds (or later edits) your step in their workflow, your app will receive a <a href="https://api.slack.com/reference/workflows/workflow_step_edit"><code class="language-plaintext highlighter-rouge">workflow_step_edit</code> event</a>. The <code class="language-plaintext highlighter-rouge">edit</code> callback in your <code class="language-plaintext highlighter-rouge">WorkflowStep</code> configuration will be run when this event is received.</p>

  <p>Whether a builder is adding or editing a step, you need to send them a <a href="https://api.slack.com/reference/workflows/configuration-view">workflow step configuration modal</a>. This modal is where step-specific settings are chosen, and it has more restrictions than typical modals‚Äîmost notably, it cannot include <code class="language-plaintext highlighter-rouge">title‚Äã</code>, <code class="language-plaintext highlighter-rouge">submit‚Äã</code>, or <code class="language-plaintext highlighter-rouge">close</code>‚Äã properties. By default, the configuration modal‚Äôs <code class="language-plaintext highlighter-rouge">callback_id</code> will be the same as the workflow step.</p>

  <p>Within the <code class="language-plaintext highlighter-rouge">edit</code> callback, the <code class="language-plaintext highlighter-rouge">configure()</code> utility can be used to easily open your step‚Äôs configuration modal by passing in an object with your view‚Äôs <code class="language-plaintext highlighter-rouge">blocks</code>. To disable saving the configuration before certain conditions are met, pass in <code class="language-plaintext highlighter-rouge">submit_disabled</code> with a value of <code class="language-plaintext highlighter-rouge">true</code>.</p>

  <p>To learn more about opening configuration modals, <a href="https://api.slack.com/workflows/steps#handle_config_view">read the documentation</a>.</p>

</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WorkflowStep</span><span class="p">(</span><span class="dl">'</span><span class="s1">add_task</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">edit</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">configure</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>

    <span class="kd">const</span> <span class="nx">blocks</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">block_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">task_name_input</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">element</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text_input</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">action_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">placeholder</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Add a task name</span><span class="dl">'</span><span class="p">,</span>
          <span class="p">},</span>
        <span class="p">},</span>
        <span class="na">label</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Task name</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">block_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">task_description_input</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">element</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text_input</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">action_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">description</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">placeholder</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Add a task description</span><span class="dl">'</span><span class="p">,</span>
          <span class="p">},</span>
        <span class="p">},</span>
        <span class="na">label</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plain_text</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Task description</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">];</span>

    <span class="k">await</span> <span class="nx">configure</span><span class="p">({</span> <span class="nx">blocks</span> <span class="p">});</span>
  <span class="p">},</span>
  <span class="na">save</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">update</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{},</span>
  <span class="na">execute</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">complete</span><span class="p">,</span> <span class="nx">fail</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{},</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="saving-steps">
              Saving step configurations
              <span class="label-deprecated">
                Deprecated
              </span>
            </h3>
            <div class="section-content">

  <p>After the configuration modal is opened, your app will listen for the <code class="language-plaintext highlighter-rouge">view_submission</code> event. The <code class="language-plaintext highlighter-rouge">save</code> callback in your <code class="language-plaintext highlighter-rouge">WorkflowStep</code> configuration will be run when this event is received.</p>

  <p>Within the <code class="language-plaintext highlighter-rouge">save</code> callback, the <code class="language-plaintext highlighter-rouge">update()</code> method can be used to save the builder‚Äôs step configuration by passing in the following arguments:</p>

  <ul>
    <li>
<code class="language-plaintext highlighter-rouge">inputs</code> is an object representing the data your app expects to receive from the user upon workflow step execution.</li>
    <li>
<code class="language-plaintext highlighter-rouge">outputs</code> is an array of objects containing data that your app will provide upon the workflow step‚Äôs completion. Outputs can then be used in subsequent steps of the workflow.</li>
    <li>
<code class="language-plaintext highlighter-rouge">step_name</code> overrides the default Step name</li>
    <li>
<code class="language-plaintext highlighter-rouge">step_image_url</code> overrides the default Step image</li>
  </ul>

  <p>To learn more about how to structure these parameters, <a href="https://api.slack.com/reference/workflows/workflow_step">read the documentation</a>.</p>

</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WorkflowStep</span><span class="p">(</span><span class="dl">'</span><span class="s1">add_task</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">edit</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">configure</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{},</span>
  <span class="na">save</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">view</span><span class="p">,</span> <span class="nx">update</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>

    <span class="kd">const</span> <span class="p">{</span> <span class="nx">values</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">taskName</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">task_name_input</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">taskDescription</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">task_description_input</span><span class="p">.</span><span class="nx">description</span><span class="p">;</span>
                
    <span class="kd">const</span> <span class="nx">inputs</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">taskName</span><span class="p">:</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">taskName</span><span class="p">.</span><span class="nx">value</span> <span class="p">},</span>
      <span class="na">taskDescription</span><span class="p">:</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">taskDescription</span><span class="p">.</span><span class="nx">value</span> <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">outputs</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">taskName</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Task name</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">taskDescription</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Task description</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">];</span>

    <span class="k">await</span> <span class="nx">update</span><span class="p">({</span> <span class="nx">inputs</span><span class="p">,</span> <span class="nx">outputs</span> <span class="p">});</span>
  <span class="p">},</span>
  <span class="na">execute</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">complete</span><span class="p">,</span> <span class="nx">fail</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{},</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

            <hr>
          </div>
          
          <div class="section-wrapper">
            <h3 id="executing-steps">
              Executing workflow steps
              <span class="label-deprecated">
                Deprecated
              </span>
            </h3>
            <div class="section-content">

  <p>When your workflow step is executed by an end user, your app will receive a <a href="https://api.slack.com/events/workflow_step_execute"><code class="language-plaintext highlighter-rouge">workflow_step_execute</code> event</a>. The <code class="language-plaintext highlighter-rouge">execute</code> callback in your <code class="language-plaintext highlighter-rouge">WorkflowStep</code> configuration will be run when this event is received.</p>

  <p>Using the <code class="language-plaintext highlighter-rouge">inputs</code> from the <code class="language-plaintext highlighter-rouge">save</code> callback, this is where you can make third-party API calls, save information to a database, update the user‚Äôs Home tab, or decide the outputs that will be available to subsequent workflow steps by mapping values to the <code class="language-plaintext highlighter-rouge">outputs</code> object.</p>

  <p>Within the <code class="language-plaintext highlighter-rouge">execute</code> callback, your app must either call <code class="language-plaintext highlighter-rouge">complete()</code> to indicate that the step‚Äôs execution was successful, or <code class="language-plaintext highlighter-rouge">fail()</code> to indicate that the step‚Äôs execution failed.</p>

</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WorkflowStep</span><span class="p">(</span><span class="dl">'</span><span class="s1">add_task</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">edit</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">configure</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{},</span>
  <span class="na">save</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">update</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{},</span>
  <span class="na">execute</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">complete</span><span class="p">,</span> <span class="nx">fail</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">inputs</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">step</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">outputs</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">taskName</span><span class="p">:</span> <span class="nx">inputs</span><span class="p">.</span><span class="nx">taskName</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
      <span class="na">taskDescription</span><span class="p">:</span> <span class="nx">inputs</span><span class="p">.</span><span class="nx">taskDescription</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="c1">// signal back to Slack that everything was successful</span>
    <span class="k">await</span> <span class="nx">complete</span><span class="p">({</span> <span class="nx">outputs</span> <span class="p">});</span>
    <span class="c1">// NOTE: If you run your app with processBeforeResponse: true option,</span>
    <span class="c1">// `await complete()` is not recommended because of the slow response of the API endpoint</span>
    <span class="c1">// which could result in not responding to the Slack Events API within the required 3 seconds</span>
    <span class="c1">// instead, use:</span>
    <span class="c1">// complete({ outputs }).then(() =&gt; { console.log('workflow step execution complete registered'); });</span>

    <span class="c1">// let Slack know if something went wrong</span>
    <span class="c1">// await fail({ error: { message: "Just testing step failure!" } });</span>
    <span class="c1">// NOTE: If you run your app with processBeforeResponse: true, use this instead:</span>
    <span class="c1">// fail({ error: { message: "Just testing step failure!" } }).then(() =&gt; { console.log('workflow step execution failure registered'); });</span>
  <span class="p">},</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

            <hr>
          </div>
          
        </div>

      </div>
    </div>
    
<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-56978219-13', 'auto');
  ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>

  </body>
</html>
