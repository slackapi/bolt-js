<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
  
    <title>Slack | Bolt</title>
    <meta name="author" content="Slack">
    <meta name="description" content="A framework that makes Slack app development fast and straight-forward.  With a single interface for Slack‚Äôs Web API, Events API, and interactive features,  Bolt gives you the full power of the Slack platform out of the box.">
    <link rel="canonical" href="http://localhost:4000/bolt/">
    <link href="https://a.slack-edge.com/17c88/style/rollup-slack_kit_legacy_adapters.css" rel="stylesheet" type="text/css">
    <link href="https://a.slack-edge.com/cc5205/style/rollup-api_site.css" rel="stylesheet" type="text/css">
    <link href="http://localhost:4000/bolt/assets/style.css" rel="stylesheet" type="text/css">
  
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    

    <!--[if lt IE 9]>
    <script src="https://a.slack-edge.com/ef0d/js/libs/html5shiv.js"></script>
    <![endif]-->
  
    <link id="favicon" rel="shortcut icon" href="https://a.slack-edge.com/4f28/img/icons/favicon-32.png" sizes="16x16 32x32 48x48" type="image/png" />
  
    <link rel="icon" href="https://a.slack-edge.com/4f28/img/icons/app-256.png" sizes="256x256" type="image/png" />
  
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://a.slack-edge.com/4f28/img/icons/ios-152.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://a.slack-edge.com/4f28/img/icons/ios-144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://a.slack-edge.com/4f28/img/icons/ios-120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://a.slack-edge.com/4f28/img/icons/ios-114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://a.slack-edge.com/4f28/img/icons/ios-72.png" />
    <link rel="apple-touch-icon-precomposed" href="https://a.slack-edge.com/4f28/img/icons/ios-57.png" />
  
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="https://a.slack-edge.com/4f28/img/icons/app-144.png" />
  
  </head>

<body>
  <div class="wrapper">
    <div class="panel">
      <div class="sidebar-content">
  <div class="logo">
    <span class="icon">
      <img src="http://localhost:4000/bolt/assets/bolt-logo.png">
    </span>

    <span class="name">
      Bolt
    </span>

    <span class="version">
      <a href="https://github.com/pages/slackapi/bolt"></a>
    </span>
  </div>

  <ul class="sidebar-section">
    <a href="#basic"><li class="title">Main concepts</li></a>
    
    
      <a href="http://localhost:4000/bolt/#message-listening"><li>Listening to messages</li></a>
    
      <a href="http://localhost:4000/bolt/#message-sending"><li>Sending messages</li></a>
    
      <a href="http://localhost:4000/bolt/#web-api"><li>Using the Web API</li></a>
    
      <a href="http://localhost:4000/bolt/#event-listening"><li>Listening to events</li></a>
    
      <a href="http://localhost:4000/bolt/#event-responding"><li>Responding to events</li></a>
    
      <a href="http://localhost:4000/bolt/#action-listening"><li>Listening to actions</li></a>
    
      <a href="http://localhost:4000/bolt/#action-acknowledge"><li>Acknowleding actions</li></a>
    
      <a href="http://localhost:4000/bolt/#action-respond"><li>Responding to actions</li></a>
    
      <a href="http://localhost:4000/bolt/#commands"><li>Listening and responding to commands</li></a>
    
      <a href="http://localhost:4000/bolt/#options"><li>Listening and responding to options</li></a>
    
  </ul>

  <ul class="sidebar-section">
    <a href="#advanced"><li class="title">Advanced concepts</li></a>
    
    
      <a href="http://localhost:4000/bolt/#error-handling"><li>Handling errors</li></a>
    
      <a href="http://localhost:4000/bolt/#authorization"><li>Authorization</li></a>
    
      <a href="http://localhost:4000/bolt/#conversation-store"><li>Conversation stores</li></a>
    
      <a href="http://localhost:4000/bolt/#global-middleware"><li>Global middleware</li></a>
    
      <a href="http://localhost:4000/bolt/#listener-middleware"><li>Listener middleware</li></a>
    
      <a href="http://localhost:4000/bolt/#context"><li>Adding context</li></a>
    
      <a href="http://localhost:4000/bolt/#logging"><li>Logging</li></a>
    
      <a href="http://localhost:4000/bolt/#receiver"><li>Customizing a receiver</li></a>
    
  </ul>
</div>

    </div>


    <div class="content">
        <div class="mainheader">
          <div class="header">
  <div class="header_nav">
    <a href="https://github.com/SlackAPI/bolt" class="btn header_btn float_right"><ts-icon class="ts_icon_github"></ts-icon>Code on GitHub</a>
    <a href="https://api.slack.com" class="btn header_btn float_right"><ts-icon class="ts_icon_slack_pillow"></ts-icon>Slack Platform Home</a>
  </div>
</div>
        </div>

        <div id="basic">
        
        
          <div class="section-wrapper">
            <h3 id="message-listening">Listening to messages</h3>

            <div class="section-content">
  <p>To listen to messages that <a href="https://api.slack.com/messaging/retrieving#permissions">your app has access to receive</a>, you can use the <code class="highlighter-rouge">message()</code> method. This method filters out any events that aren‚Äôt of type <code class="highlighter-rouge">message</code>.</p>

  <p>It accepts an optional <code class="highlighter-rouge">pattern</code> parameter of type <code class="highlighter-rouge">string</code> or <code class="highlighter-rouge">RegExp</code> object that will filter out any messages that don‚Äôt match.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// This will match any message that contains üëã</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="s1">':wave:'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">say</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">say</span><span class="p">(</span><span class="s2">`Hello, &lt;@</span><span class="p">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">user</span><span class="p">}</span><span class="s2">&gt;`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>

<details>
  <summary class="section-head">
    <h4 class="section-head">Using a RegExp pattern</h4>
  </summary>

  <div class="secondary-wrapper">

    <div class="secondary-content">
      <p>A RegExp pattern can be used instead of a string for more granular matching.</p>

      <p>All of the results of the RegExp match will be in <code class="highlighter-rouge">context.matches</code>.</p>
    </div>

    <div class="language-javascript highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="sr">/^</span><span class="se">(</span><span class="sr">hi|hello|hey</span><span class="se">)</span><span class="sr">.*/</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="p">{</span>
  <span class="c1">// RegExp matches are inside of context.matches</span>
  <span class="kd">const</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  
  <span class="nx">say</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">greeting</span><span class="p">}</span><span class="s2">, how are you?`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>    </div>

  </div>
</details>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="message-sending">Sending messages</h3>

            <div class="section-content">
  <p>If you‚Äôre using a built-in method (<code class="highlighter-rouge">message()</code>, <code class="highlighter-rouge">event()</code>, <code class="highlighter-rouge">action()</code>, <code class="highlighter-rouge">command()</code>, or <code class="highlighter-rouge">options()</code>), <code class="highlighter-rouge">say()</code> is available to your listener middleware whenever there is an associated channel (the conversation a message was posted in, for example). <code class="highlighter-rouge">say()</code> accepts a string to post simple text-based messages and JSON payloads to send more complex messages. The message payload you pass in will be sent to the associated channel.</p>

  <p>In the case that you aren‚Äôt in listener middleware for one of the built-in methods or you want to do something more advanced (like handle specific errors), you can call <code class="highlighter-rouge">chat.postMessage</code> <a href="#web-api">using the client attached to your Bolt instance</a>.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s1">'bold'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">command</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">say</span><span class="p">(</span><span class="s2">`*</span><span class="p">${</span><span class="nx">command</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2">*`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>

<details>
  <summary>
    <h4 class="section-head">Sending a message with blocks</h4>
  </summary>

  <div class="secondary-wrapper">

    <div class="secondary-content">
      <p><code class="highlighter-rouge">say()</code> accepts more complex message payloads to make it easy to add functionality and structure to your messages.</p>

      <p>To explore adding rich message layouts to your app, read through <a href="https://api.slack.com/messaging/composing/layouts">the guide on our API site</a> and look through templates of common app flows <a href="https://api.slack.com/tools/block-kit-builder?template=1">in the Block Kit Builder</a>.</p>
    </div>

    <div class="language-javascript highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">// Sends a section block with datepicker when someone reacts with a üìÖ emoji</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">'reaction_added'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">reaction</span> <span class="o">===</span> <span class="s1">'calendar'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">say</span><span class="p">({</span>
      <span class="na">blocks</span><span class="p">:</span> <span class="p">[{</span>
          <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"section"</span><span class="p">,</span>
          <span class="s2">"text"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"mrkdwn"</span><span class="p">,</span>
            <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"Pick a date for me to remind you"</span>
          <span class="p">},</span>
          <span class="s2">"accessory"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"datepicker"</span><span class="p">,</span>
            <span class="s2">"action_id"</span><span class="p">:</span> <span class="s2">"datepicker_remind"</span><span class="p">,</span>
            <span class="s2">"initial_date"</span><span class="p">:</span> <span class="s2">"2019-04-28"</span><span class="p">,</span>
            <span class="s2">"placeholder"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"plain_text"</span><span class="p">,</span>
              <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"Select a date"</span>
             <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}]});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>    </div>

  </div>
</details>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="web-api">Using the Web API</h3>

            <div class="section-content">
  <p>You can call <a href="https://api.slack.com/methods">any Web API method</a> using the client attached to your Bolt instance under the <code class="highlighter-rouge">client</code> key (given that your app has the appropriate scopes). When you call one of the methods on the <code class="highlighter-rouge">client</code>, it will return a promise containing the response from Slack.</p>

  <p>The token used to initialize Bolt can be found in the <code class="highlighter-rouge">context</code> object, which can be helpful when you‚Äôre making calls and need to pass the token yourself.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// Unix Epoch time for September 30, 2019 11:59:59 PM</span>
<span class="kd">const</span> <span class="nx">whenSeptemberEnds</span> <span class="o">=</span> <span class="mi">1569887999</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="s1">'wake me up'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">context</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Call the chat.scheduleMessage method</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">scheduleMessage</span><span class="p">({</span>
      <span class="na">token</span><span class="p">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">botToken</span><span class="p">,</span>
      <span class="na">channel</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
      <span class="na">post_at</span><span class="p">:</span> <span class="nx">whenSeptemberEnds</span><span class="p">,</span>
      <span class="na">text</span><span class="p">:</span> <span class="s1">'Summer has come and passed'</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="event-listening">Listening to events</h3>

            <div class="section-content">
  <p>You can listen to <a href="https://api.slack.com/events">any Events API event</a> using the <code class="highlighter-rouge">event()</code> method. This allows your app to take action when something happens in Slack, like a user reacting to a message or joining a channel.</p>

  <p>The <code class="highlighter-rouge">event()</code> method requires an <code class="highlighter-rouge">eventType</code> of type string.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="kd">const</span> <span class="nx">welcomeChannelId</span> <span class="o">=</span> <span class="s1">'C12345'</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">'team_join'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">context</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
      <span class="na">token</span><span class="p">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">botToken</span><span class="p">,</span>
      <span class="na">channel</span><span class="p">:</span> <span class="nx">welcomeChannelId</span><span class="p">,</span>
      <span class="na">text</span><span class="p">:</span> <span class="s2">`Welcome to the team, &lt;@</span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">&gt;! üéâ You can introduce yourself in this channel.`</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>

<details>
  <summary class="section-head">
    <h4 class="section-head">Filtering on event subtypes</h4>
  </summary>

  <div class="secondary-wrapper">

    <div class="secondary-content">
      <p>You can filter on subtypes of events by using the built-in <code class="highlighter-rouge">matchEventSubtype()</code> middleware. Common message subtypes like <code class="highlighter-rouge">bot_message</code> and <code class="highlighter-rouge">message_replied</code> can be found <a href="https://api.slack.com/events/message#message_subtypes">on the message event page</a>.</p>
    </div>

    <div class="language-javascript highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">// event('message') is the same as message()</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> <span class="nx">matchEventSubtype</span><span class="p">(</span><span class="s1">'bot_message'</span><span class="p">),</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">event</span> <span class="p">})</span> <span class="o">=&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`The bot user </span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">user</span><span class="p">}</span><span class="s2"> said </span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>    </div>

  </div>
</details>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="event-responding">Responding to events</h3>

            <div class="section-content">
  <p>The easiest way to respond to events is using the <code class="highlighter-rouge">say</code> function, which exists in any listener middleware function when a channel exists in the event payload. The <code class="highlighter-rouge">say</code> function accepts a message payload of type string for simple text responses, and of type object for more complex responses.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// app_home_opened is triggered when a user opens your App's DM</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s1">'app_home_opened'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">say</span><span class="p">(</span><span class="s2">`Hi &lt;@</span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">&gt; :wave: If you've never used me before you can type 'help' to see all of my features`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="action-listening">Listening to actions</h3>

            <div class="section-content">
  <p>Your app can listen to user actions like button clicks, menu selects, and message actions using the <code class="highlighter-rouge">action</code> method.</p>

  <p>Actions can be filtered on  an <code class="highlighter-rouge">action_id</code> of type string or RegExp. <code class="highlighter-rouge">action_id</code>s act as unique identifiers for interactive components on the Slack platform.</p>

  <p>You‚Äôll notice in all <code class="highlighter-rouge">action()</code> examples, <code class="highlighter-rouge">ack()</code> is used. It is required to call the <code class="highlighter-rouge">ack()</code> function within an action listener to acknowledge the event was received from Slack. This is discussed in the <a href="#action-acknowledging">acknowledging actions section</a>.</p>

</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// Your middleware will be called every time an interactive component with the action_id "approve_button" is triggered</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">'approve_button'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">ack</span><span class="p">();</span>
  <span class="c1">// Update the message to reflect the action</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>

<details>
  <summary class="section-head">
    <h4 class="section-head">Listening to actions using a constraint object</h4>
  </summary>

  <div class="secondary-wrapper">

    <div class="secondary-content">
      <p>You can use a constraints object to listen to <code class="highlighter-rouge">callback_id</code>s, <code class="highlighter-rouge">block_id</code>s, and <code class="highlighter-rouge">action_id</code>s (or any combination of them). Constraints in the object can be of type string or RegExp.</p>
    </div>

    <div class="language-javascript highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">// Your middleware will only be called when the action_id matches 'select_user' AND the block_id matches 'assign_ticket'</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">({</span> <span class="na">action_id</span><span class="p">:</span> <span class="s1">'select_user'</span><span class="p">,</span> <span class="na">block_id</span><span class="p">:</span> <span class="s1">'assign_ticket'</span> <span class="p">},</span>
  <span class="k">async</span> <span class="p">({</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">context</span> <span class="p">})</span> <span class="o">=&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="p">{</span>
    <span class="nx">ack</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">reactions</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span>
        <span class="na">token</span><span class="p">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">botToken</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="s1">'white_check_mark'</span><span class="p">,</span>
        <span class="na">timestamp</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">action_ts</span><span class="p">,</span>
        <span class="na">channel</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">id</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>    </div>

  </div>
</details>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="action-acknowledge">Acknowleding actions</h3>

            <div class="section-content">
  <p>Actions must <strong>always</strong> be acknowledged using the <code class="highlighter-rouge">ack()</code> function. This lets Slack know that the action was received and updates the Slack user interface accordingly. Depending on the type of action, your acknowledgement may be different. For example, when responding to a dialog submission you will call <code class="highlighter-rouge">ack()</code> with validation errors if the submission contains errors, or with no parameters if the submission is valid.</p>

  <p>We recommend calling <code class="highlighter-rouge">ack()</code> right away before sending a new message or fetching information from your database since you only have 3 seconds to respond.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// Regex to determine if this is a valid email</span>
<span class="kd">let</span> <span class="nx">isEmail</span> <span class="o">=</span> <span class="o">^</span><span class="p">[</span><span class="err">\</span><span class="nx">w</span><span class="o">-</span><span class="err">\</span><span class="p">.]</span><span class="o">+</span><span class="p">@([</span><span class="err">\</span><span class="nx">w</span><span class="o">-</span><span class="p">]</span><span class="o">+</span><span class="err">\</span><span class="p">.)</span><span class="o">+</span><span class="p">[</span><span class="err">\</span><span class="nx">w</span><span class="o">-</span><span class="p">]{</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">}</span><span class="nx">$</span>
<span class="c1">// This uses a constraint object to listen for dialog submissions with a callback_id of ticket_submit </span>
<span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">({</span> <span class="na">callback_id</span><span class="p">:</span> <span class="s1">'ticket_submit'</span> <span class="p">},</span> <span class="p">({</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">ack</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="c1">// it‚Äôs a valid email, accept the submission</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isEmail</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">submission</span><span class="p">.</span><span class="nx">email</span><span class="p">))</span> <span class="p">{</span>
	  <span class="nx">ack</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="c1">// if it isn‚Äôt a valid email, respond with an error</span>
	  <span class="nx">ack</span><span class="p">({</span>
		  <span class="na">errors</span><span class="p">:</span> <span class="p">[{</span>
			  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"email_address"</span><span class="p">,</span>
			  <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"Sorry, this isn‚Äôt a valid email"</span>
      <span class="p">}]</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="action-respond">Responding to actions</h3>

            <div class="section-content">
  <p>There are two main ways to respond to actions. The first way (and the most common way) is using the <code class="highlighter-rouge">say</code> function. The <code class="highlighter-rouge">say</code> function sends a message back to the conversation where the incoming event took place.</p>

  <p>The second way to respond to actions is using <code class="highlighter-rouge">respond()</code>. This is a simple utility to use the <code class="highlighter-rouge">response_url</code> associated with an action.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// Your middleware will be called every time an interactive component with the action_id ‚Äúapprove_button‚Äù is triggered</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">'approve_button'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">ack</span><span class="p">();</span>
  <span class="nx">say</span><span class="p">(</span><span class="s1">'Request approved üëç'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>

<details>
  <summary class="section-head">
    <h4 class="section-head">Using respond()</h4>
  </summary>

  <div class="secondary-wrapper">

    <div class="secondary-content">
      <p>In addition to using <code class="highlighter-rouge">say()</code>, you can respond to them using <code class="highlighter-rouge">respond()</code>. <code class="highlighter-rouge">respond()</code> is a utility for calling the <code class="highlighter-rouge">response_url</code>, so it behaves in the same way. You can pass a JSON object with a new message payload that will be published back to the source of the original interaction. Response URLs are covered in more depth <a href="https://api.slack.com/messaging/interactivity">on our API site</a>.</p>
    </div>

    <div class="language-javascript highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">// Listens to actions triggered with action_id of ‚Äúuser_select‚Äù</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">'user_select'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">respond</span> <span class="p">})</span> <span class="o">=&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="p">{</span>
	<span class="nx">ack</span><span class="p">();</span>
	<span class="nx">respond</span><span class="p">(</span><span class="s2">`You selected &amp;lt;@</span><span class="p">${</span><span class="nx">action</span><span class="p">.</span><span class="nx">selected_user</span><span class="p">}</span><span class="s2">&amp;gt;`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>    </div>

  </div>
</details>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="commands">Listening and responding to commands</h3>

            <div class="section-content">
  <p>Your app can use the <code class="highlighter-rouge">command()</code> method to listen to incoming slash command payloads. The method requires a <code class="highlighter-rouge">commandName</code> of type string that matches the incoming command name.</p>

  <p>Similar to actions, there are two ways to respond to slash command requests. The first way is to use <code class="highlighter-rouge">say()</code>, which accepts a string or JSON payload. The second is <code class="highlighter-rouge">respond()</code> which uses the <code class="highlighter-rouge">response_url</code>.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// The echo command simply echoes on command</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s1">'echo'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">command</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">say</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">command</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="options">Listening and responding to options</h3>

            <div class="section-content">
  <p>The <code class="highlighter-rouge">option()</code> method listens for incoming option request payloads from Slack. <a href="#action-listening">Similar to <code class="highlighter-rouge">actions()</code></a>,
an <code class="highlighter-rouge">action_id</code> or constraints object is required.</p>

  <p>While it‚Äôs recommended to use <code class="highlighter-rouge">action_id</code> for <code class="highlighter-rouge">external_select</code> menus, dialogs do not yet support Block Kit so you‚Äôll have to 
use the constraints object to filter on a <code class="highlighter-rouge">callback_id</code>.</p>

  <p>To respond to options requests, you‚Äôll need to <code class="highlighter-rouge">ack()</code> with valid options. Both <a href="https://api.slack.com/reference/messaging/block-elements#external-select">external select response examples</a> and <a href="https://api.slack.com/dialogs#dynamic_select_elements_external">dialog response examples</a> can be found on our API site.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// Example of responding to an external_select options request</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">options</span><span class="p">(</span><span class="s1">'external_action'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">ack</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Get information specific to a team or channel</span>
  <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">db</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">team</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="c1">// Collect information in options array to send in Slack ack response</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">result</span> <span class="k">in</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="s2">"text"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"plain_text"</span><span class="p">,</span>
          <span class="s2">"text"</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">label</span>
        <span class="p">},</span>
        <span class="s2">"value"</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">value</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">ack</span><span class="p">({</span>
      <span class="s2">"options"</span><span class="p">:</span> <span class="nx">options</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">ack</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
        </div>

        <div id="advanced">
          
          
          <div class="section-wrapper">
            <h3 id="error-handling">Handling errors</h3>

            <div class="section-content">
  <p>If an error occurs in a listener middleware, it‚Äôs recommended you handle it directly. However, there are cases where errors may occur after your listener middleware has returned (like <code class="highlighter-rouge">say()</code> and <code class="highlighter-rouge">respond()</code>, or not calling <code class="highlighter-rouge">ack()</code>). By default, these errors will be logged to the console. To handle them yourself, you can attach a global error handler to your app using the <code class="highlighter-rouge">App.prototype.error(fn)</code> method.</p>

  <p>If you want more control over errors, it‚Äôs advised to use the <a href="https://api.slack.com/methods/chat.postMessage"><code class="highlighter-rouge">chat.postMessage</code></a> method attached to your app under the <code class="highlighter-rouge">client</code> key. This returns a <code class="highlighter-rouge">Promise</code> that can be caught to handle the error.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">error</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="c1">// Check the details of the error to handle cases where you should retry sending a message or stop the app</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="authorization">Authorization</h3>

            <div class="section-content">
  <p>Custom apps installed on just one team can define <code class="highlighter-rouge">token</code> (and optionally <code class="highlighter-rouge">botId</code> and <code class="highlighter-rouge">botUserId</code>) at the time of app initialization. But in the case you want to handle multiple tokens, authorization functions can be passed in rather than a <code class="highlighter-rouge">token</code>. Authorization functions must have <code class="highlighter-rouge">source</code> and <code class="highlighter-rouge">body</code> as parameters and are expected to return a Promise that resolves to an <code class="highlighter-rouge">AuthorizeResult</code>.</p>

  <ul>
    <li>
      <p><code class="highlighter-rouge">source</code> will be provided to an authorize function and will always contain a <code class="highlighter-rouge">teamId</code>, and will contain an <code class="highlighter-rouge">enterpriseId</code>, a <code class="highlighter-rouge">userId</code>, and a <code class="highlighter-rouge">conversationId</code> when they exist for the event.</p>
    </li>
    <li>
      <p><code class="highlighter-rouge">body</code> will be provided as the request body of the event.</p>
    </li>
  </ul>

  <p>After you app is initialized, the authorization function will be run as an incoming event is passed from the Receiver. This will give opportunity to add the proper token and bot user and app IDs (which are used for the builtin <code class="highlighter-rouge">ignoreSelf</code> middleware).</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// NOTE: This is for demonstration purposes only.</span>
<span class="c1">// All sensitive data should be stored in a secure database</span>
<span class="kd">let</span> <span class="nx">teamInfo</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">'E1234A12AB'</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'T12345'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">botToken</span><span class="p">:</span> <span class="s1">'xoxb-123abc'</span><span class="p">,</span>
      <span class="na">botId</span><span class="p">:</span> <span class="s1">'B1251'</span><span class="p">,</span>
      <span class="na">botUserId</span><span class="p">:</span> <span class="s1">'U12385'</span> 
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s1">'E5678B23CD'</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'T77712'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">botToken</span><span class="p">:</span> <span class="s1">'xoxb-102anc'</span><span class="p">,</span>
      <span class="na">botId</span><span class="p">:</span> <span class="s1">'B5910'</span><span class="p">,</span>
      <span class="na">botUserId</span><span class="p">:</span> <span class="s1">'U1239'</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">authorizeFn</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Fetch team info from database. You could also set userToken instead.</span>
  <span class="kd">const</span> <span class="nx">fetchAuthorizedTeam</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">teamInfo</span><span class="p">[</span><span class="nx">source</span><span class="p">.</span><span class="nx">enterpriseId</span><span class="p">][</span><span class="nx">source</span><span class="p">.</span><span class="nx">teamId</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="p">?</span>
      <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">teamInfo</span><span class="p">[</span><span class="nx">source</span><span class="p">.</span><span class="nx">enterpriseId</span><span class="p">][</span><span class="nx">source</span><span class="p">.</span><span class="nx">teamId</span><span class="p">])</span> <span class="p">:</span>
      <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="kd">const</span> <span class="nx">authorizedTeam</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetchAuthorizedTeam</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
    <span class="na">botToken</span><span class="p">:</span> <span class="nx">authorizedTeam</span><span class="p">.</span><span class="nx">botToken</span><span class="p">,</span>
    <span class="na">botId</span><span class="p">:</span> <span class="nx">authorizedTeam</span><span class="p">.</span><span class="nx">botId</span><span class="p">,</span>
    <span class="na">botUserId</span><span class="p">:</span> <span class="nx">authorizedTeam</span><span class="p">.</span><span class="nx">botUserId</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="conversation-store">Conversation stores</h3>

            <div class="section-content">
  <p>Bolt includes support for a store, which sets and retrieves state related to a conversation. Conversation stores have two methods:</p>
  <ul>
    <li>
<code class="highlighter-rouge">set()</code> modifies conversation state. <code class="highlighter-rouge">set()</code> requires a <code class="highlighter-rouge">conversationId</code> of type string, <code class="highlighter-rouge">value</code> that can be any type, and an optional <code class="highlighter-rouge">expiresAt</code> of type number.  <code class="highlighter-rouge">set()</code> returns a <code class="highlighter-rouge">Promise</code>.</li>
    <li>
<code class="highlighter-rouge">get()</code> fetches conversation state from the store. Get requires a <code class="highlighter-rouge">conversationId</code> of type string and returns a Promise with the conversation‚Äôs state.</li>
  </ul>

  <p><code class="highlighter-rouge">conversationContext()</code> is a built-in <a href="#global-middleware">global middleware</a> that allows conversations to be updated by middleware. When receiving an event, middleware functions can use <code class="highlighter-rouge">context.updateConversation()</code> to set state and reading from <code class="highlighter-rouge">context.conversation</code> to retrieve it.</p>

  <p>The default (built-in) conversation store simply stores conversation state in memory. While this is sufficient for some situations, if there is more than one instance of your app running the state will not be shared among your processes so you‚Äôll want to implement a conversation store that fetches conversation state from a database.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="nx">token</span><span class="p">,</span>
  <span class="nx">signingSecret</span><span class="p">,</span>
  <span class="c1">// It's more likely that you'd create a class for a convo store</span>
  <span class="na">convoStore</span><span class="p">:</span> <span class="k">new</span> <span class="nx">simpleConvoStore</span><span class="p">()</span>
<span class="p">});</span>

<span class="c1">// A simple implementation of a conversation store with a Firebase-like database</span>
<span class="kd">class</span> <span class="nx">simpleConvoStore</span> <span class="p">{</span>
  <span class="kd">set</span><span class="p">(</span><span class="nx">conversationId</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">expiresAt</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Returns a Promise</span>
    <span class="k">return</span> <span class="nx">db</span><span class="p">().</span><span class="nx">ref</span><span class="p">(</span><span class="s1">'conversations/'</span> <span class="o">+</span> <span class="nx">conversationId</span><span class="p">).</span><span class="kd">set</span><span class="p">({</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">expiresAt</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">get</span><span class="p">(</span><span class="nx">conversationId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Returns a Promise</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">db</span><span class="p">().</span><span class="nx">ref</span><span class="p">(</span><span class="s1">'conversations/'</span> <span class="o">+</span> <span class="nx">conversationId</span><span class="p">).</span><span class="nx">once</span><span class="p">(</span><span class="s1">'value'</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">expiresAt</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">result</span><span class="p">.</span><span class="nx">expiresAt</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">db</span><span class="p">().</span><span class="nx">ref</span><span class="p">(</span><span class="s1">'conversations/'</span> <span class="o">+</span> <span class="nx">conversationId</span><span class="p">).</span><span class="k">delete</span><span class="p">();</span>

            <span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Conversation expired'</span><span class="p">));</span>
          <span class="p">}</span>
          <span class="nx">resolve</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">// Conversation not found</span>
          <span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Conversation not found'</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="global-middleware">Global middleware</h3>

            <div class="section-content">
  <p>Global middleware is run for all incoming events before any listener middleware. You can add any number of global middleware to your app by utilizing <code class="highlighter-rouge">app.use(fn(payload,...,next))</code>.</p>

  <p>Both global and listener middleware must call <code class="highlighter-rouge">next()</code> to pass control of the execution chain to the next middleware, or call <code class="highlighter-rouge">next(error)</code> to pass an error back up the already-executed middleware chain.</p>

  <p>As an example, let‚Äôs say your app should only respond to users identified with a corresponding internal authentication service (an SSO provider or LDAP, for example). You may define a global middleware that looks up a user record in the authentication service and errors if the user is not found.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// Authentication middleware that associates incoming event with user in Acme identity provider</span>
<span class="kd">function</span> <span class="nx">authWithAcme</span><span class="p">({</span> <span class="nx">payload</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">say</span><span class="p">,</span> <span class="nx">next</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">slackUserId</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">helpChannelId</span> <span class="o">=</span> <span class="s1">'C12345'</span><span class="p">;</span>

  <span class="c1">// Assume we have a function that accepts a Slack user ID to find user details from Acme</span>
  <span class="nx">acme</span><span class="p">.</span><span class="nx">lookupBySlackId</span><span class="p">(</span><span class="nx">slackUserId</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// When the lookup is successful, populate context with Acme user details</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>

      <span class="c1">// Pass control to the next middleware and any listener functions</span>
      <span class="nx">next</span><span class="p">();</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// This user wasn't found in Acme. Send them an error and don't continue processing event</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="o">===</span> <span class="s1">'Not Found'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">postEphemeral</span><span class="p">({</span>
          <span class="na">token</span><span class="p">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">botToken</span><span class="p">,</span>
          <span class="na">channel</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">channel</span><span class="p">,</span>
          <span class="na">user</span><span class="p">:</span> <span class="nx">slackUserId</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="s2">`Sorry &lt;@</span><span class="p">${</span><span class="nx">slackUserId</span><span class="p">}</span><span class="s2">, you aren't registered in Acme. Please post in &lt;#</span><span class="p">${</span><span class="nx">helpChannelId</span><span class="p">}</span><span class="s2"> for assistance.`</span>
        <span class="p">});</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// Pass control to previous middleware (if any) or the global error handler</span>
      <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="listener-middleware">Listener middleware</h3>

            <div class="section-content">
  <p>Listener middleware is used for logic across many listener functions (but usually not all of them). They are added as arguments before the listener function in one of the built-in methods. You can add any number of listener middleware before the listener function.</p>

  <p>There‚Äôs a collection of built-in listener middleware that you can use like <code class="highlighter-rouge">subtype()</code> for filtering on a message subtype and <code class="highlighter-rouge">directionMention()</code> which filters out any message that doesn‚Äôt directly @-mention your bot.</p>

  <p>But of course, you can write your own middleware for more custom functionality. While writing your own middleware, your function must call <code class="highlighter-rouge">next()</code> to pass control to the next middleware, or calling <code class="highlighter-rouge">next(error)</code> to pass an error back up the already-executed middleware chain.</p>

  <p>As an example, let‚Äôs say your listener should only deal with messages from humans. You can write a listener middleware that excludes any bot messages.</p>

</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// Listener middleware that filters out messages with 'bot_message' subtype</span>
<span class="kd">function</span> <span class="nx">noBotMessages</span><span class="p">({</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">next</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">||</span> <span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">!==</span> <span class="s1">'bot_message'</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// The listener only receives messages from humans</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="nx">noBotMessages</span><span class="p">,</span> <span class="p">({</span> <span class="nx">message</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
  <span class="s2">`(MSG) User: </span><span class="p">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">user</span><span class="p">}</span><span class="s2">
   Message: </span><span class="p">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2">`</span>
<span class="p">));</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="context">Adding context</h3>

            <div class="section-content">
  <p>All listeners have access to a <code class="highlighter-rouge">context</code> object, which can be used to enrich events with additional information. For example, perhaps you want to add user information from a third party system or add temporary state for the next middleware in the chain.</p>

  <p><code class="highlighter-rouge">context</code> is just an object, so you can add to it by setting it to a modified version of itself.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">addTimezoneContext</span> <span class="p">({</span> <span class="nx">payload</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">next</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">info</span><span class="p">({</span>
    <span class="na">token</span><span class="p">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">botToken</span><span class="p">,</span>
    <span class="na">user</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">user_id</span><span class="p">,</span>
    <span class="na">include_locale</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">});</span>

  <span class="c1">// Add user's timezone context</span>
  <span class="nx">context</span><span class="p">.</span><span class="nx">tz_offset</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">tz_offset</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s1">'request'</span><span class="p">,</span> <span class="nx">addTimezoneContext</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">command</span><span class="p">,</span> <span class="nx">context</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Get local hour of request</span>
  <span class="kd">const</span> <span class="nx">local_hour</span> <span class="o">=</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">UTC</span><span class="p">()</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">tz_offset</span><span class="p">).</span><span class="nx">getHours</span><span class="p">();</span>

  <span class="c1">// Request channel ID</span>
  <span class="kd">const</span> <span class="nx">requestChannel</span> <span class="o">=</span> <span class="s1">'C12345'</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">requestText</span> <span class="o">=</span> <span class="s2">`:large_blue_circle: *New request from &lt;@</span><span class="p">${</span><span class="nx">command</span><span class="p">.</span><span class="nx">user_id</span><span class="p">}</span><span class="s2">&gt;*: </span><span class="p">${</span><span class="nx">command</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

  <span class="c1">// If request not inbetween 9AM and 5PM, send request tomorrow</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">local_hour</span> <span class="o">&gt;</span> <span class="mi">17</span> <span class="o">||</span> <span class="nx">local_hour</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Assume function exists to get local tomorrow 9AM from offset</span>
    <span class="kd">const</span> <span class="nx">local_tomorrow</span> <span class="o">=</span> <span class="nx">getLocalTomorrow</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">tz_offset</span><span class="p">);</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// Schedule message</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">scheduleMessage</span><span class="p">({</span>
        <span class="na">token</span><span class="p">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">botToken</span><span class="p">,</span>
        <span class="na">channel</span><span class="p">:</span> <span class="nx">requestChannel</span><span class="p">,</span>
        <span class="na">text</span><span class="p">:</span> <span class="nx">requestText</span><span class="p">,</span>
        <span class="na">post_at</span><span class="p">:</span> <span class="nx">local_tomorrow</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// Post now</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
        <span class="na">token</span><span class="p">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">botToken</span><span class="p">,</span>
        <span class="na">channel</span><span class="p">:</span> <span class="nx">requestChannel</span><span class="p">,</span>
        <span class="na">text</span><span class="p">:</span> <span class="nx">requestText</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="logging">Logging</h3>

            <div class="section-content">
  <p>By default, Bolt will log information from your app to the console. You can customize how much logging occurs by passing a <code class="highlighter-rouge">logLevel</code> in the constructor. The available log levels in order of most to least logs are <code class="highlighter-rouge">DEBUG</code>, <code class="highlighter-rouge">INFO</code>, <code class="highlighter-rouge">WARN</code>, and <code class="highlighter-rouge">ERROR</code>.</p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="c1">// Import LogLevel from the package</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span><span class="p">,</span> <span class="nx">LogLevel</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'@slack/bolt'</span><span class="p">);</span>

<span class="c1">// Log level is one of the options you can set in the constructor</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="nx">token</span><span class="p">,</span>
  <span class="nx">signingSecret</span><span class="p">,</span>
  <span class="na">logLevel</span><span class="p">:</span> <span class="nx">LogLevel</span><span class="p">.</span><span class="nx">DEBUG</span><span class="p">,</span>
<span class="p">});</span>
</code></pre>
  </div>
</div>

<details>
  <summary class="section-head">
    <h4 class="section-head">Sending log output somewhere besides the console</h4>
  </summary>

  <div class="secondary-wrapper">

    <div class="secondary-content">
      <p>If you want to send logs to somewhere besides the console or want more control over the logger, you can implement a logger. A custom logger must implement specific methods (known as the <code class="highlighter-rouge">Logger</code> interface):</p>

      <table>
        <thead>
          <tr>
            <th>Method</th>
            <th>Parameters</th>
            <th>Return type</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code class="highlighter-rouge">setLevel()</code></td>
            <td><code class="highlighter-rouge">level: LogLevel</code></td>
            <td><code class="highlighter-rouge">void</code></td>
          </tr>
          <tr>
            <td><code class="highlighter-rouge">setName()</code></td>
            <td><code class="highlighter-rouge">name: string</code></td>
            <td><code class="highlighter-rouge">void</code></td>
          </tr>
          <tr>
            <td><code class="highlighter-rouge">debug()</code></td>
            <td><code class="highlighter-rouge">...msgs: any[]</code></td>
            <td><code class="highlighter-rouge">void</code></td>
          </tr>
          <tr>
            <td><code class="highlighter-rouge">info()</code></td>
            <td><code class="highlighter-rouge">...msgs: any[]</code></td>
            <td><code class="highlighter-rouge">void</code></td>
          </tr>
          <tr>
            <td><code class="highlighter-rouge">warn()</code></td>
            <td><code class="highlighter-rouge">...msgs: any[]</code></td>
            <td><code class="highlighter-rouge">void</code></td>
          </tr>
          <tr>
            <td><code class="highlighter-rouge">error()</code></td>
            <td><code class="highlighter-rouge">...msgs: any[]</code></td>
            <td><code class="highlighter-rouge">void</code></td>
          </tr>
        </tbody>
      </table>

      <p>A very simple custom logger might ignore the name and level, and write all messages to a file.</p>
    </div>

    <div class="language-javascript highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'@slack/bolt'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">createWriteStream</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">logWritable</span> <span class="o">=</span> <span class="nx">createWriteStream</span><span class="p">(</span><span class="s1">'/var/my_log_file'</span><span class="p">);</span> <span class="c1">// Not shown: close this stream</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="nx">token</span><span class="p">,</span>
  <span class="nx">signingSecret</span><span class="p">,</span>
  <span class="c1">// Creating a logger as a literal object. It's more likely that you'd create a class.</span>
  <span class="na">logger</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">debug</span><span class="p">(...</span><span class="nx">msgs</span><span class="p">):</span> <span class="p">{</span> <span class="nx">logWritable</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'debug: '</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">msgs</span><span class="p">));</span> <span class="p">},</span>
    <span class="nx">info</span><span class="p">(...</span><span class="nx">msgs</span><span class="p">):</span> <span class="p">{</span> <span class="nx">logWritable</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'info: '</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">msgs</span><span class="p">));</span> <span class="p">},</span>
    <span class="nx">warn</span><span class="p">(...</span><span class="nx">msgs</span><span class="p">):</span> <span class="p">{</span> <span class="nx">logWritable</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'warn: '</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">msgs</span><span class="p">));</span> <span class="p">},</span>
    <span class="nx">error</span><span class="p">(...</span><span class="nx">msgs</span><span class="p">):</span> <span class="p">{</span> <span class="nx">logWritable</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'error: '</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">msgs</span><span class="p">));</span> <span class="p">},</span>
    <span class="nx">setLevel</span><span class="p">():</span> <span class="p">{</span> <span class="p">},</span>
    <span class="nx">setName</span><span class="p">():</span> <span class="p">{</span> <span class="p">},</span>
  <span class="p">},</span>
<span class="p">});</span>
</code></pre></div>    </div>

  </div>
</details>


            <hr>
          </div>
        
          <div class="section-wrapper">
            <h3 id="receiver">Customizing a receiver</h3>

            <div class="section-content">
  <p>A receiver is responsible for handling and parsing any incoming requests from Slack, then emitting the request so the Bolt app can add context and pass the request to your app‚Äôs listeners. Receivers must conform to the Receiver interface:</p>

  <table>
    <thead>
      <tr>
        <th>Method</th>
        <th>Parameters</th>
        <th>Return type</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code class="highlighter-rouge">on()</code></td>
        <td>
<code class="highlighter-rouge">type: string</code>, <code class="highlighter-rouge">listener: fn()</code>
</td>
        <td><code class="highlighter-rouge">void</code></td>
      </tr>
      <tr>
        <td><code class="highlighter-rouge">start()</code></td>
        <td>None</td>
        <td><code class="highlighter-rouge">Promise</code></td>
      </tr>
      <tr>
        <td><code class="highlighter-rouge">stop()</code></td>
        <td>None</td>
        <td><code class="highlighter-rouge">Promise</code></td>
      </tr>
    </tbody>
  </table>

  <p><code class="highlighter-rouge">on()</code> is called two times in the Bolt app:</p>
  <ul>
    <li>
<code class="highlighter-rouge">Receiver.on('message',  listener)</code> should route all incoming requests that have been parsed to <code class="highlighter-rouge">onIncomingEvent()</code>. It‚Äôs called in the Bolt app as <code class="highlighter-rouge">this.receiver.on('message', message =&gt; this.onIncomingEvent(message))</code>.</li>
    <li>
<code class="highlighter-rouge">Receiver.on('error',  listener)</code> should route errors to the global error handler. It‚Äôs called in the Bolt app as <code class="highlighter-rouge">this.receiver.on('error', error =&gt; this.onGlobalError(error))</code>.</li>
  </ul>

  <p>To use a custom receiver, you‚Äôll need to pass it into the constructor when initializing your Bolt app. Here is what a basic custom receiver might look like.</p>

  <p>For a more in-depth look at a receiver, <a href="https://github.com/slackapi/bolt/blob/master/src/ExpressReceiver.ts">read the source code for the built-in Express receiver</a></p>
</div>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">EventEmitter</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'events'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">createServer</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'http'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">express</span> <span class="k">from</span> <span class="s1">'express'</span><span class="p">;</span>

<span class="c1">// EventEmitter handles the on() function for us</span>
<span class="c1">// https://nodejs.org/api/events.html#events_emitter_on_eventname_listener</span>
<span class="kd">class</span> <span class="nx">simpleReceiver</span> <span class="kd">extends</span> <span class="nx">EventEmitter</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">signingSecret</span><span class="p">,</span> <span class="nx">endpoints</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">server</span> <span class="o">=</span> <span class="nx">createServer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">endpoint</span> <span class="k">of</span> <span class="nx">endpoints</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">requestHandler</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">start</span><span class="p">(</span><span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">stop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">resolve</span><span class="p">();</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="c1">// This is a very simple implementation. Look at the ExpressReceiver source for more detail</span>
  <span class="nx">requestHandler</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Assume parseBody function exists to parse incoming requests</span>
    <span class="kd">const</span> <span class="nx">parsedReq</span> <span class="o">=</span> <span class="nx">parseBody</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">event</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">body</span><span class="p">:</span> <span class="nx">parsedReq</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
      <span class="c1">// Receivers are responsible for handling acknowledgements</span>
      <span class="na">ack</span><span class="p">:</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
  </div>
</div>


            <hr>
          </div>
        
        </div>
    </div>

  </div>
</body>
</html>