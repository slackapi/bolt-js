<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
  
    <title>Slack | Bolt for JavaScript</title>
    <meta name="author" content="Slack">
    <meta name="description" content="A framework that makes Slack app development fast and straight-forward. With a single interface for Slack’s Web API, Events API, and interactive features, Bolt gives you the full power of the Slack platform out of the box.">
    <link rel="canonical" href="http://localhost:4000/bolt-js/ja-jp/deployments/aws-lambda">
    <link href="https://a.slack-edge.com/17c88/style/rollup-slack_kit_legacy_adapters.css" rel="stylesheet" type="text/css">
    <link href="https://a.slack-edge.com/cc5205/style/rollup-api_site.css" rel="stylesheet" type="text/css">
    
      <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP:400,700&display=swap" rel="stylesheet">
    
    <link href="http://localhost:4000/bolt-js/assets/style.css" rel="stylesheet" type="text/css">
  
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    

    <!--[if lt IE 9]>
    <script src="https://a.slack-edge.com/ef0d/js/libs/html5shiv.js"></script>
    <![endif]-->
  
    <link id="favicon" rel="shortcut icon" href="http://localhost:4000/bolt-js/assets/bolt-favicon.png" sizes="16x16 32x32 48x48" type="image/png" />
  
  </head>


<body>
  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KFZ5MK7');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KFZ5MK7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <div class="wrapper">
    <div class="panel">
      <div class="sidebar-content">
  <div class="logo">
    <span class="icon">
      <img src="http://localhost:4000/bolt-js/assets/bolt-js-logo.svg">
    </span>

    <span class="name">
      Bolt
    </span>

    <!-- Liquid has no ternary operator, so this is just meant to exclude 
      english sections since they are at the root URL -->
    

    <span class="version">
      
      <a href="https://github.com/slackapi/bolt-js/releases/tag/%40slack/bolt%403.18.0">v3.18.0</a>
    </span>
  </div>

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/ja-jp/tutorial/getting-started"><li class="title">Bolt 入門ガイド</li></a>
    <a href="http://localhost:4000/bolt-js/ja-jp/reference"><li class="title">リファレンス</li></a>
  </ul>

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#basic"><li class="title">基本的な概念</li></a>
     
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#message-listening">
      <li>メッセージ・イベントのリスニング</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#message-sending">
      <li>メッセージの送信</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#event-listening">
      <li>イベントのリスニング</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#web-api">
      <li>Web API の使用</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#action-listening">
      <li>アクションのリスニング</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#action-respond">
      <li>アクションへの応答</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#acknowledge">
      <li>リクエストの確認</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#shortcuts">
      <li>ショートカットのリスニング</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#commands">
      <li>コマンドのリスニングと応答</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#creating-modals">
      <li>モーダルの開始</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#updating-pushing-views">
      <li>モーダルの更新と多重表示</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#view-submissions">
      <li>モーダルでの送信のリスニング</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#publishing-views">
      <li>ホームタブの更新</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#options">
      <li>オプションのリスニングと応答</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#authenticating-oauth">
      <li>OAuth フローの実装</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#socket-mode">
      <li>ソケットモードの使用</li>
    </a>
    
  </ul>

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#advanced">
      <li class="title">応用コンセプト</li>
    </a>
     
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#error-handling">
      <li>エラーの処理</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#authorization">
      <li>認可（Authorization）</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#token-rotation">
      <li>トークンのローテーション</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#conversation-store">
      <li>会話ストア</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#global-middleware">
      <li>グローバルミドルウェア</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#listener-middleware">
      <li>リスナーミドルウェア</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#context">
      <li>context の追加</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#logging">
      <li>ログの表示</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#receiver">
      <li>レシーバーのカスタマイズ</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#custom-routes">
      <li>カスタム HTTP ルートの追加</li>
    </a>
    
  </ul>

  
  
    <ul class="sidebar-section"> 
        <li class="title">Deployments</li>
      
        <a href="http://localhost:4000/bolt-js/ja-jp/deployments/aws-lambda">
          <li>AWS Lambda へのデプロイ</li>
        </a>
      
        <a href="http://localhost:4000/bolt-js/ja-jp/deployments/heroku">
          <li>Heroku へのデプロイ</li>
        </a>
      
    </ul>
  

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/ja-jp/concepts#steps">
      <li class="title">
        ワークフローステップ
        <span class="label-deprecated">
          非推奨
        </span>
      </li>
    </a>
     
      
    
      
      <a href="http://localhost:4000/bolt-js/ja-jp/concepts#creating-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          ステップの定義
        </li>
      </a>
      
    
      
      <a href="http://localhost:4000/bolt-js/ja-jp/concepts#adding-editing-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          ステップの追加・編集
        </li>
      </a>
      
    
      
      <a href="http://localhost:4000/bolt-js/ja-jp/concepts#saving-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          ステップの設定の保存
        </li>
      </a>
      
    
      
      <a href="http://localhost:4000/bolt-js/ja-jp/concepts#executing-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          ステップの実行
        </li>
      </a>
      
    
  </ul>

  <ul class="sidebar-section">
    
    
    <a href="http://localhost:4000/bolt-js/ja-jp/tutorial/getting-started-http">
      <li class="title">Bolt 入門ガイド (HTTP)</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/tutorial/hubot-migration">
      <li class="title">Hubot から Bolt に移行する方法</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/tutorial/migration-v2">
      <li class="title">2.x マイグレーションガイド</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/tutorial/migration-v3">
      <li class="title">3.x マイグレーションガイド</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/ja-jp/tutorial/using-typescript">
      <li class="title">TypeScript での利用ガイド</li>
    </a>
    
    <a href="https://github.com/SlackAPI/bolt-js/blob/main/.github/contributing.md">
      <li class="title">貢献</li>
    </a>
  </ul>
</div>

    </div>


    <div class="content">
        <div class="mainheader">
          <div class="header">
  <div class="header_nav">
    <a href="https://github.com/SlackAPI/bolt-js" class="btn header_btn float_right"><ts-icon class="ts_icon_github"></ts-icon>Code on GitHub</a>
    <a href="https://api.slack.com" class="btn header_btn float_right"><ts-icon class="ts_icon_slack_pillow"></ts-icon>Slack Platform Home</a>
    <!-- If we add more languages, this logic will need to change -->
    
      <a href="http://localhost:4000/bolt-js/" class="header_btn language-switcher float_right">English</a>
    
    </div>
</div>
        </div>

        <div class="tutorial-nav">
          <ul class="tutorial-nav-list"></ul>
        </div>
        
        <div class="tutorial">
          <h1 id="aws-lambda-へのデプロイ">AWS Lambda へのデプロイ</h1>

<div class="section-content">
  <p>このガイドでは、<a href="/bolt-js">Bolt for JavaScript</a>、<a href="https://serverless.com/">Serverless Framework</a>、<a href="https://aws.amazon.com/lambda/">AWS Lambda</a> を使った Slack アプリの準備とデプロイの方法について説明します。</p>
</div>

<p>この手順を全て終わらせたら、あなたはきっと⚡️ <a href="https://github.com/slackapi/bolt-js/tree/main/examples/deploy-aws-lambda">Deploying to AWS Lambda</a> のサンプルアプリを動作させたり、それに変更を加えたり、自分のアプリを作ったりすることができるようになるでしょう。</p>

<hr>

<h3 id="set-up-aws-lambda">AWS Lambda のセットアップ</h3>

<p><a href="https://aws.amazon.com/lambda/">AWS Lambda</a> はサーバーレスの Function-as-a-Service（FaaS）プラットフォームです。AWS Lambda を利用すると、サーバーを管理することなく、コードを実行することができます。このセクションでは、ローカルマシンから AWS Lambda にアクセスするための設定を行います。</p>

<blockquote>
  <p>💡 すでにローカルマシンから AWS Lambda へのアクセスに必要な<a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-profiles">プロファイルの構成</a>が済んでいる場合、このセクションはスキップできます。</p>
</blockquote>

<p><strong>1. AWS アカウントを作成する</strong></p>

<p>AWS アカウントをまだ持っていない場合は、<a href="https://aws.amazon.com/">アカウントを作成</a>する必要があります。画面に表示される案内に沿って作成しましょう。</p>

<blockquote>
  <p>💡 作成手順の中で請求情報の入力を求められる場合がありますが、ご心配なく。このガイドでは<a href="https://aws.amazon.com/lambda/pricing/">無料利用枠</a>のみを使用します。</p>
</blockquote>

<p><strong>2. AWS のアクセスキーを作成する</strong></p>

<p>Lambda へのデプロイでは、プログラムから AWS アカウントにアクセスする手段が必要になります。AWS の世界では、このために<strong>アクセスキー ID</strong> と<strong>シークレットアクセスキー</strong>が必要です。</p>

<p>🍿 <a href="https://www.youtube.com/watch?v=KngM5bfpttA">IAM ユーザーを作成してアクセスキーをダウンロードする手順</a>を紹介する短い動画を参考にしてみてください。</p>

<blockquote>
  <p>💡 <strong>すでに IAM ユーザーの作成が完了している場合は、</strong>AWS の公式ガイドに従って <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-creds">IAM ユーザーのアクセスキーを作成</a>してください。</p>
</blockquote>

<p><strong>3. AWS CLI をインストールする</strong></p>

<p>AWS では <a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html">macOS、Windows、Linux</a> にインストールして利用できるコマンドラインインターフェイス（CLI）のツールが用意されています。</p>

<p>macOS では、<a href="https://awscli.amazonaws.com/AWSCLIV2.pkg">最新の .pkg インストーラーをダウンロード</a>して AWS CLI をインストールできます。</p>

<p><strong>4. AWS プロファイルを構成する</strong></p>

<p>AWS CLI を使ってプロファイルを構成します。プロファイルはローカルマシンに置かれ、アクセスキーのペアを保管します。この CLI やその他のツールは、このプロファイルを使って AWS にアクセスします。</p>

<p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-config">プロファイルを構成</a>する最も簡単な方法は、次のコマンドを実行し、プロンプトに従って入力する方法です。</p>

<div class="language-zsh highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre>aws configure
<span class="c"># AWS Access Key ID [None]: &lt;AWS のアクセスキー&gt;</span>
<span class="c"># AWS Secret Access Key [None]: &lt;AWS のシークレットアクセスキー&gt;</span>
<span class="c"># Default region name [None]: us-east-1</span>
<span class="c"># Default output format [None]: json</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<blockquote>
  <p>💡 <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-region">Default region name</a> と <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-format">Default output format</a> は最も望ましい設定でカスタマイズしてください。</p>
</blockquote>

<p>これでローカルマシンから AWS にアクセスするための設定が完了しました。👏 次は、同じように Serverless Framework も設定していきましょう。</p>

<hr>

<h3 id="set-up-serverless-framework">Serverless Framework をセットアップする</h3>

<p><a href="https://serverless.com/">Serverless Framework</a> では、AWS Lambda 向けのアプリの設定、デバッグ、デプロイを簡単に行うためのツールが用意されています。</p>

<p><strong>1. Serverless Framework CLI をインストールする</strong></p>

<p>Serverless でも macOS、Windows、Linux にインストールして利用できるコマンドラインインターフェイス（CLI）のツールが用意されています。インストールするには Serverless の<a href="https://www.serverless.com/framework/docs/getting-started/">入門ガイド（英語）</a> をお読みください。</p>

<p>インストールが完了したら Serverless CLI をテストするため、利用可能なコマンドを表示してみましょう。</p>

<div class="language-shell highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>serverless <span class="nb">help</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<p>Serverless のツールのセットアップが完了しました。次に、AWS Lambda 関数として実行する Bolt アプリの準備へと進みましょう。</p>

<hr>

<h3 id="get-a-bolt-slack-app">Bolt Slack アプリを入手する</h3>

<p>まだ Bolt アプリを自分で作成したことがない場合は、<a href="/bolt-js/ja-jp/tutorial/getting-started">入門ガイド</a>を参照してください。テンプレートのアプリをクローンするには、以下のコマンドを実行します。</p>

<div class="language-shell highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>git clone https://github.com/slackapi/bolt-js-getting-started-app.git
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<p>用意した Bolt アプリのディレクトリに移動します。</p>

<div class="language-shell highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nb">cd </span>bolt-js-getting-started-app/
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<p>Bolt アプリを用意できました。次に AWS Lambda と Serverless Framework に対応するための準備をします。</p>

<hr>

<h3 id="prepare-the-app">アプリをセットアップする</h3>

<p><strong>1. アプリを AWS Lambda に対応させる</strong></p>

<p>デフォルトでは、入門ガイドの Bolt サンプルアプリはソケットモードを使用しています。WebSocket イベントの代わりに HTTP リクエストをリッスンするため、 <code class="language-plaintext highlighter-rouge">app.js</code> の設定を変更しましょう。</p>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="c1">// ボットトークンを使ってアプリを初期化します</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_BOT_TOKEN</span><span class="p">,</span>
  <span class="na">socketMode</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// この行を削除します</span>
  <span class="na">appToken</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_APP_TOKEN</span><span class="p">,</span> <span class="c1">// この行を削除します</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<p>次に Lambda 関数のイベントに応答するよう、Bolt アプリの <a href="/bolt-js/ja-jp/concepts#receiver"><code class="language-plaintext highlighter-rouge">receiver</code></a> をカスタマイズします。</p>

<p><code class="language-plaintext highlighter-rouge">app.js</code> のソースコードの中で<a href="https://github.com/slackapi/bolt-js-getting-started-app/blob/main/app.js#L1">モジュールのインポートを行う部分</a>を編集し、Bolt の <code class="language-plaintext highlighter-rouge">AwsLambdaReceiver</code> モジュールを require します。</p>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">App</span><span class="p">,</span> <span class="nx">AwsLambdaReceiver</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@slack/bolt</span><span class="dl">'</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<blockquote>
  <p>💡  OAuth フローを実装するなら、現時点では <a href="https://github.com/slackapi/bolt-js/blob/main/src/receivers/ExpressReceiver.ts"><code class="language-plaintext highlighter-rouge">ExpressReceiver</code></a> を使用する必要があります。</p>
</blockquote>

<p>その後、<a href="https://github.com/slackapi/bolt-js-getting-started-app/blob/4c29a21438b40f0cbca71ece0d39b356dfcf88d5/app.js#L10-L14">ソースコードの中で Bolt アプリの初期化を行う部分</a>を編集して、<code class="language-plaintext highlighter-rouge">AwsLambdaReceiver</code> を使ったカスタムのレシーバーを作成します。</p>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
<td class="rouge-code"><pre><span class="c1">// カスタムのレシーバーを初期化します</span>
<span class="kd">const</span> <span class="nx">awsLambdaReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AwsLambdaReceiver</span><span class="p">({</span>
  <span class="na">signingSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_SIGNING_SECRET</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// ボットトークンと、AWS Lambda に対応させたレシーバーを使ってアプリを初期化します。</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">({</span>
    <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SLACK_BOT_TOKEN</span><span class="p">,</span>
    <span class="na">receiver</span><span class="p">:</span> <span class="nx">awsLambdaReceiver</span><span class="p">,</span>
    
    <span class="c1">// AwsLambdaReceiver を利用する場合は  `processBeforeResponse` は省略可能です。</span>
    <span class="c1">// OAuth フローに対応した ExpressReceiver など、他のレシーバーを使用する場合、</span>
    <span class="c1">// `processBeforeResponse: true` が必要になります。</span>
    <span class="c1">// このオプションは、ハンドラーの実行が完了するまで応答を返すのを遅延させます。</span>
    <span class="c1">// これによってハンドラーがトリガーとなった HTTP リクエストに応答を返すことでただちに終了されることを防ぐことができます。</span>
    
    <span class="c1">//processBeforeResponse: true</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<p>最後に、アプリのソースコードの末尾にある <a href="https://github.com/slackapi/bolt-js-getting-started-app/blob/main/app.js#L47-L52">HTTP サーバーを起動する部分</a>を編集して、AWS Lambda 関数のイベントに応答するようにします。</p>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="c1">// Lambda 関数のイベントを処理します</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">awsLambdaReceiver</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
  <span class="k">return</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<p>完成したアプリのソースコードは、⚡️<a href="https://github.com/slackapi/bolt-js/tree/main/examples/deploy-aws-lambda/app.js">deploy-aws-lambda</a> のサンプルのようになります。</p>

<p><strong>2. serverless.yml を追加する</strong></p>

<p>Serverless Framework のプロジェクトでは、アプリの設定とデプロイに <code class="language-plaintext highlighter-rouge">serverless.yml</code> ファイルを使用します。</p>

<p>アプリのルートディレクトリに <code class="language-plaintext highlighter-rouge">serverless.yml</code> という名前のファイルを新規作成し、次の内容を貼りつけます。</p>

<div class="language-yaml highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
<td class="rouge-code"><pre><span class="na">service</span><span class="pi">:</span> <span class="s">serverless-bolt-js</span>
<span class="na">frameworkVersion</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3'</span>
<span class="na">provider</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">aws</span>
  <span class="na">runtime</span><span class="pi">:</span> <span class="s">nodejs14.x</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="na">SLACK_SIGNING_SECRET</span><span class="pi">:</span> <span class="s">${env:SLACK_SIGNING_SECRET}</span>
    <span class="na">SLACK_BOT_TOKEN</span><span class="pi">:</span> <span class="s">${env:SLACK_BOT_TOKEN}</span>
<span class="na">functions</span><span class="pi">:</span>
  <span class="na">slack</span><span class="pi">:</span>
    <span class="na">handler</span><span class="pi">:</span> <span class="s">app.handler</span>
    <span class="na">events</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">http</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">slack/events</span>
          <span class="na">method</span><span class="pi">:</span> <span class="s">post</span>
<span class="na">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">serverless-offline</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<blockquote>
  <p>💡 <code class="language-plaintext highlighter-rouge">SLACK_SIGNING_SECRET</code> と <code class="language-plaintext highlighter-rouge">SLACK_BOT_TOKEN</code> の環境変数は、ローカルマシンで設定しておく必要があります。<a href="/bolt-js/ja-jp/tutorial/getting-started#setting-up-your-project">Slack の環境変数をエクスポートする方法</a>を入門ガイドで参照してください。</p>
</blockquote>

<p><strong>3. serverless-offline モジュールをインストールする</strong></p>

<p>ローカルでの開発を容易にするため、<code class="language-plaintext highlighter-rouge">serverless-offline</code> モジュールを使ってデプロイ対象の関数をエミュレートできるようにしましょう。</p>

<p>次のコマンドを実行して、開発用の devDependencies としてインストールします。</p>

<div class="language-bash highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>npm <span class="nb">install</span> <span class="nt">--save-dev</span> serverless-offline
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<p>これで Bolt アプリを AWS Lambda と Serverless に対応させることができました。次はアプリの実行とデプロイに進みます。</p>

<hr>

<h3 id="run-the-app-locally">アプリをローカルで実行する</h3>

<p>アプリを AWS Lambda 関数に応答させるための準備が完了したので、次にローカルでアプリを実行できるように環境を設定します。</p>

<p><strong>1. ローカルのサーバーを起動する</strong></p>

<p>まず、アプリの起動と AWS Lambda 関数のイベントをリッスンするため、<code class="language-plaintext highlighter-rouge">serverless offline</code> コマンドを実行します。</p>

<div class="language-zsh highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>serverless offline <span class="nt">--noPrependStageInUrl</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<blockquote>
  <p>🏌️ Pro-tip: 別のターミナルで上記のコマンドを実行しておくことで、ターミナル上でアプリのコードを変更することができます。コードの変更を保存する度、アプリは自動的にリロードされます。</p>
</blockquote>

<p>次に、ngrok を使って Slack のイベントをローカルマシンに転送します。</p>

<div class="language-zsh highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>ngrok http 3000
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<blockquote>
  <p>💡 パブリック URL の作成方法と、ローカルマシンへのリクエストの転送方法については、<a href="https://slack.dev/bolt-js/ja-jp/tutorial/getting-started#setting-up-events">ngrok の使い方</a>を参照してください。</p>
</blockquote>

<p><strong>2. リクエスト URL を変更する</strong></p>

<p>次に、<a href="https://api.slack.com/apps">Slack アプリの設定</a>を開き、<strong>リクエスト URL</strong> を ngrok のウェブアドレスに変更します。</p>

<blockquote>
  <p>💡 <strong>リクエスト URL</strong> は <code class="language-plaintext highlighter-rouge">/slack/events</code> で終わる文字列で、例えば <code class="language-plaintext highlighter-rouge">https://abc123.ngrok.io/slack/events</code> のようになります。</p>
</blockquote>

<p>まず、サイドバーの「<strong>Interactivity &amp; Shortcuts</strong>」を選択し、<strong>リクエスト URL</strong> を更新します。</p>

<p><img src="../../assets/interactivity-and-shortcuts-page.png" alt="「Interactivity &amp; Shortcuts」ページ" title="「Interactivity &amp; Shortcuts」ページ"></p>

<p>次に、サイドバーの「<strong>Event Subscriptions</strong>」を選択し、<strong>リクエスト URL</strong> を更新します。</p>

<p><img src="../../assets/event-subscriptions-page.png" alt="「Event Subscriptions」ページ" title="「Event Subscriptions」ページ"></p>

<p><strong>3. Slack アプリをテストする</strong></p>

<p>Slack アプリをテストします。今作った Bolt アプリを Slack のチャンネルに招待し、半角の小文字で「hello」と入力してみましょう。<a href="/bolt-js/ja-jp/tutorial/getting-started">入門ガイド</a>のとおり、アプリから応答があるはずです。</p>

<blockquote>
  <p>👩‍💻 hello<br>
🤖 Hey there @Jane!</p>
</blockquote>

<p>応答がない場合、<strong>リクエスト URL</strong> を確認してからもう一度試してみてください。</p>

<blockquote>
  <p>💡 <strong>動作の仕組み</strong> : ngrok と Serverless のコマンドは同じポートを使用するように設定されています（デフォルトでは「3000」）。<strong>リクエスト URL</strong> に向けて送信された Slack イベントは、ローカルマシンの ngrok で受信されます。このリクエストはさらに Serverless Offline に転送されます。Serverless Offline は AWS Lambda 関数のイベントをエミュレートしていて、Bolt アプリのレシーバーをトリガーさせます。 🛫🛬 長旅ですね。</p>
</blockquote>

<hr>

<h3 id="deploy-the-app">アプリをデプロイする</h3>

<p>今までローカルでアプリを実行し、 Slack ワークスペースでテストをしてきました。さて、動作するアプリができたので、デプロイしてみましょう!</p>

<p>AWS Lambda 向けのアプリのプロビジョニング、パッケージング、デプロイには、Serverless Framework のツールが利用できます。アプリのデプロイが完了したら、アプリのリクエスト URL を更新して、「hello」と入力した時にアプリが応答できるようにします。✨</p>

<p><strong>1. AWS Lambda にアプリをデプロイする</strong></p>

<p>次のコマンドを使って AWS Lambda にアプリをデプロイします。</p>

<div class="language-shell highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre>serverless deploy
<span class="c"># Serverless:Packaging service...</span>
<span class="c"># ...</span>
<span class="c"># endpoints:</span>
<span class="c">#   POST - https://atuzelnkvd.execute-api.us-east-1.amazonaws.com/dev/slack/events</span>
<span class="c"># ...</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<p>アプリのデプロイが成功すると、<strong>エンドポイント</strong>が発行されます。これをアプリの<strong>リクエスト URL</strong> に指定します。発行された<strong>エンドポイント</strong>をコピーして、次のセクションで使います。</p>

<blockquote>
  <p>💡 <strong>エンドポイント</strong>は、<code class="language-plaintext highlighter-rouge">/slack/events</code> で終わる文字列です。</p>
</blockquote>

<p><strong>2. Slack アプリの設定を更新する</strong></p>

<p>Slack からのイベントやアクションの送信先となる<strong>リクエスト URL</strong> に、発行された AWS Lambda の<strong>エンドポイント</strong>を指定します。<a href="https://api.slack.com/apps">Slack アプリの構成</a>を開き、先ほどコピーしたエンドポイントを<strong>リクエスト URL</strong> に貼りつけます。</p>

<p>まず、サイドバーの「<strong>Interactivity &amp; Shortcuts</strong>」を選択し、<strong>リクエスト URL</strong> を更新します。</p>

<p><img src="../../assets/interactivity-and-shortcuts-page.png" alt="「Interactivity &amp; Shortcuts」ページ" title="「Interactivity &amp; Shortcuts」ページ"></p>

<p>次に、サイドバーの「<strong>Event Subscriptions</strong>」を選択し、<strong>リクエスト URL</strong> を更新します。</p>

<p><img src="../../assets/event-subscriptions-page.png" alt="「Event Subscriptions」ページ" title="「Event Subscriptions」ページ"></p>

<p><strong>3. Slack アプリをテストする</strong></p>

<p>アプリのデプロイと、Slack の設定の更新が完了しました。動作を試してみましょう。</p>

<p>「<a href="#run-the-app-locally">アプリをローカルで実行する</a>」のセクションで行った操作と同様に、アプリを招待した Slack チャンネルを開いて「hello」と入力します。アプリが応答し、同じように挨拶してくれるはずです。</p>

<blockquote>
  <p>👩‍💻 hello<br>
🤖 Hey there @Jane!</p>
</blockquote>

<p><strong>4. 更新をデプロイする</strong></p>

<p>Slack アプリの開発を継続していくなら、更新したアプリをデプロイする必要が出てくるでしょう。それをやってみるために、「goodbye」というメッセージに応答するようにアプリを変更してみましょう。</p>

<p>次のコードを <code class="language-plaintext highlighter-rouge">app.js</code> に追加します（<a href="https://github.com/slackapi/bolt-js/tree/main/examples/deploy-aws-lambda/app.js">GitHub でソースコードを確認できます</a>）。</p>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="c1">// 「goodbye」というメッセージの着信をリッスンします</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="dl">'</span><span class="s1">goodbye</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">say</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// イベントがトリガーされたチャンネルに向けて say() でメッセージを送信します</span>
  <span class="k">await</span> <span class="nx">say</span><span class="p">(</span><span class="s2">`See ya later, &lt;@</span><span class="p">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">user</span><span class="p">}</span><span class="s2">&gt; :wave:`</span><span class="p">);</span>
<span class="p">});</span>
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<p>先ほどと同じコマンドを使って更新をデプロイします。</p>

<div class="language-shell highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>serverless deploy
</pre></td>
</tr></tbody></table></code></pre>
  </div>
</div>

<p>デプロイが完了したら、アプリを参加させた Slack チャンネルを開いて、半角の小文字で「goodbye」と入力してみましょう。Slack アプリに「See you later」と表示されるはずです。</p>

<blockquote>
  <p>⛳️ 一つの関数に小さな変更を加える場合、その関数だけをデプロイするためにより高速な <code class="language-plaintext highlighter-rouge">serverless deploy function -f my-function</code> を実行することができます。より詳細なヘルプを見るには <code class="language-plaintext highlighter-rouge">serverless help deploy function</code> を実行してください。</p>
</blockquote>

<hr>

<h3 id="next-steps">次のステップ</h3>

<p>⚡️<a href="https://github.com/slackapi/bolt-js/tree/main/examples/deploy-aws-lambda">AWS Lambda を使った最初の Bolt for JavaScript アプリ</a>をデプロイできました。🚀</p>

<p>基本的なアプリのデプロイができましたので、次はアプリのカスタマイズやモニタリングを行う方法を調べてみましょう。</p>

<ul>
  <li>
<a href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html">AWS Lambda</a> と <a href="https://www.serverless.com/framework/docs/providers/aws/guide/intro/">Serverless Framework</a> の理解を深める。</li>
  <li>
<a href="/bolt-js/ja-jp/concepts#basic">Bolt の基本的な概念</a>と <a href="https://www.serverless.com/framework/docs/providers/aws/guide/plugins/">Serverless のプラグイン</a>を活用してアプリを拡張する。</li>
  <li>
<a href="/bolt-js/ja-jp/concepts#logging">Bolt の応用コンセプト</a>でログの記録についての知識を深めたり、<a href="https://www.serverless.com/framework/docs/providers/aws/cli-reference/logs/">Serverless でのログメッセージの表示方法</a>について確認したりする。</li>
  <li>Serverless の <a href="https://www.serverless.com/framework/docs/providers/aws/guide/testing/">AWS Lambda のテスト環境</a>や<a href="https://www.serverless.com/framework/docs/providers/aws/guide/deploying/">デプロイ環境</a>を本格的に活用する。</li>
</ul>


        </div>
    </div>

  </div>
  <script src="http://localhost:4000/bolt-js/scripts/tutorial_nav.js"></script>

  
<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-56978219-13', 'auto');
  ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>

</body>
</html>