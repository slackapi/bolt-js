<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
  
    <title>Slack | Bolt for JavaScript</title>
    <meta name="author" content="Slack">
    <meta name="description" content="A framework that makes Slack app development fast and straight-forward. With a single interface for Slack’s Web API, Events API, and interactive features, Bolt gives you the full power of the Slack platform out of the box.">
    <link rel="canonical" href="http://localhost:4000/bolt-js/tutorial/migration-v2">
    <link href="https://a.slack-edge.com/17c88/style/rollup-slack_kit_legacy_adapters.css" rel="stylesheet" type="text/css">
    <link href="https://a.slack-edge.com/cc5205/style/rollup-api_site.css" rel="stylesheet" type="text/css">
    
    <link href="http://localhost:4000/bolt-js/assets/style.css" rel="stylesheet" type="text/css">
  
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    

    <!--[if lt IE 9]>
    <script src="https://a.slack-edge.com/ef0d/js/libs/html5shiv.js"></script>
    <![endif]-->
  
    <link id="favicon" rel="shortcut icon" href="http://localhost:4000/bolt-js/assets/bolt-favicon.png" sizes="16x16 32x32 48x48" type="image/png" />
  
  </head>


<body>
  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KFZ5MK7');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KFZ5MK7" 
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <div class="wrapper">
    <div class="panel">
      <div class="sidebar-content">
  <div class="logo">
    <span class="icon">
      <img src="http://localhost:4000/bolt-js/assets/bolt-js-logo.svg" />
    </span>

    <span class="name">
      Bolt
    </span>

    <!-- Liquid has no ternary operator, so this is just meant to exclude 
      english sections since they are at the root URL -->
    

    <span class="version">
      
      <a href="https://github.com/slackapi/bolt-js/releases/tag/%40slack/bolt%403.18.0">v3.18.0</a>
    </span>
  </div>

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/tutorial/getting-started"
      ><li class="title">Getting started</li></a
    >
    <a href="http://localhost:4000/bolt-js/reference"
      ><li class="title">Reference</li></a
    >
  </ul>

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/concepts#basic"
      ><li class="title">Basic concepts</li></a
    >
     
    <a href="http://localhost:4000/bolt-js/concepts#message-listening">
      <li>Listening to messages</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#message-sending">
      <li>Sending messages</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#event-listening">
      <li>Listening to events</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#web-api">
      <li>Using the Web API</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#action-listening">
      <li>Listening to actions</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#action-respond">
      <li>Responding to actions</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#acknowledge">
      <li>Acknowledging requests</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#shortcuts">
      <li>Listening and responding to shortcuts</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#commands">
      <li>Listening and responding to commands</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#creating-modals">
      <li>Opening modals</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#updating-pushing-views">
      <li>Updating and pushing views</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#view-submissions">
      <li>Listening to views</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#publishing-views">
      <li>Publishing views to App Home</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#options">
      <li>Listening and responding to options</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#authenticating-oauth">
      <li>Authenticating with OAuth</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#socket-mode">
      <li>Using Socket Mode</li>
    </a>
    
  </ul>

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/concepts#advanced">
      <li class="title">Advanced concepts</li>
    </a>
     
    <a href="http://localhost:4000/bolt-js/concepts#error-handling">
      <li>Handling errors</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#authorization">
      <li>Authorization</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#token-rotation">
      <li>Token rotation</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#conversation-store">
      <li>Conversation stores</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#global-middleware">
      <li>Global middleware</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#listener-middleware">
      <li>Listener middleware</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#context">
      <li>Adding context</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#deferring-initialization">
      <li>Deferring App initialization</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#logging">
      <li>Logging</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#receiver">
      <li>Customizing a receiver</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/concepts#custom-routes">
      <li>Adding Custom HTTP routes</li>
    </a>
    
  </ul>

  
  
    <ul class="sidebar-section"> 
        <li class="title">Deployments</li>
      
        <a href="http://localhost:4000/bolt-js/deployments/aws-lambda">
          <li>AWS Lambda</li>
        </a>
      
        <a href="http://localhost:4000/bolt-js/deployments/heroku">
          <li>Heroku Platform</li>
        </a>
      
    </ul>
  

  <ul class="sidebar-section">
    <a href="http://localhost:4000/bolt-js/concepts#steps">
      <li class="title">
        Workflow steps
        <span class="label-deprecated">
          Deprecated
        </span>
      </li>
    </a>
     
      
    
      
      <a href="http://localhost:4000/bolt-js/concepts#creating-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          Creating workflow steps
        </li>
      </a>
      
    
      
      <a href="http://localhost:4000/bolt-js/concepts#adding-editing-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          Adding or editing workflow steps
        </li>
      </a>
      
    
      
      <a href="http://localhost:4000/bolt-js/concepts#saving-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          Saving step configurations
        </li>
      </a>
      
    
      
      <a href="http://localhost:4000/bolt-js/concepts#executing-steps">
        
        <!--UNCOMMENT AFTER GA  -->
        <li>
          Executing workflow steps
        </li>
      </a>
      
    
  </ul>

  <ul class="sidebar-section">
    
    
    <a href="http://localhost:4000/bolt-js/tutorial/getting-started-http">
      <li class="title">Getting started with HTTP</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/tutorial/hubot-migration">
      <li class="title">Migrating Hubot apps</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/tutorial/migration-v2">
      <li class="title">Migrating to V2</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/tutorial/migration-v3">
      <li class="title">Migrating to V3</li>
    </a>
    
    <a href="http://localhost:4000/bolt-js/tutorial/using-typescript">
      <li class="title">Using TypeScript</li>
    </a>
    
    <a href="https://github.com/SlackAPI/bolt-js/blob/main/.github/contributing.md">
      <li class="title">Contributing</li>
    </a>
  </ul>
</div>

    </div>


    <div class="content">
        <div class="mainheader">
          <div class="header">
  <div class="header_nav">
    <a href="https://github.com/SlackAPI/bolt-js" class="btn header_btn float_right"><ts-icon class="ts_icon_github"></ts-icon>Code on GitHub</a>
    <a href="https://api.slack.com" class="btn header_btn float_right"><ts-icon class="ts_icon_slack_pillow"></ts-icon>Slack Platform Home</a>
    <!-- If we add more languages, this logic will need to change -->
    
      <a href="http://localhost:4000/bolt-js/ja-jp" class="header_btn language-switcher float_right">日本語 (Japanese)</a>
    
    </div>
</div>
        </div>

        <div class="tutorial-nav">
          <ul class="tutorial-nav-list"></ul>
        </div>
        
        <div class="tutorial">
          <h1 id="migrating-to-v2x">Migrating to v2.x</h1>

<div class="section-content">
  <p>This guide will walk you through the process of updating your app from using <code class="language-plaintext highlighter-rouge">@slack/bolt@1.x</code> to <code class="language-plaintext highlighter-rouge">@slack/bolt@2.x</code>. There are a few changes you’ll need to make but for most apps, these changes can be applied in 5 - 15 minutes.</p>

  <p><em>Note: Make sure to checkout our <a href="#slackbolt1x-support-schedule">support schedule</a> for <code class="language-plaintext highlighter-rouge">@slack/bolt@1.x</code> if you don’t plan on upgrading right away</em></p>
</div>

<hr />

<h3 id="upgrading-your-listeners-to-async">Upgrading your listeners to <code class="language-plaintext highlighter-rouge">async</code></h3>

<p>Listeners in your app should updated to <code class="language-plaintext highlighter-rouge">async</code> functions and <code class="language-plaintext highlighter-rouge">say()</code>,  <code class="language-plaintext highlighter-rouge">respond()</code>, and <code class="language-plaintext highlighter-rouge">ack()</code> should be prefaced with <code class="language-plaintext highlighter-rouge">await</code>.</p>

<p>Before:</p>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="dl">'</span><span class="s1">some-action-id</span><span class="dl">'</span><span class="p">,</span> <span class="p">({</span><span class="nx">action</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">say</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span> 
  <span class="nx">ack</span><span class="p">();</span>
  <span class="nx">say</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></pre>
  </div>
</div>

<p>After:</p>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="dl">'</span><span class="s1">some-action-id</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span><span class="nx">action</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">say</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span> 
  <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>
  <span class="k">await</span> <span class="nx">say</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></pre>
  </div>
</div>

<h3 id="error-handling">Error Handling</h3>

<p>The recent changes in Bolt for JavaScript V2 have improved our ability to catch errors and filter them to the global error handler.  It is still recommended to manage errors in the listeners themselves instead of letting them propagate to the global handler when possible.</p>

<h4 id="handling-errors-in-listeners-with-trycatch">Handling Errors in Listeners with <code class="language-plaintext highlighter-rouge">try</code>/<code class="language-plaintext highlighter-rouge">catch</code></h4>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="dl">'</span><span class="s1">some-action-id</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span><span class="nx">action</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">say</span><span class="p">,</span> <span class="nx">logger</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span> 
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>
    <span class="k">await</span> <span class="nx">say</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="c1">// handle error</span>
  <span class="p">}</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></pre>
  </div>
</div>

<h4 id="handling-errors-with-the-global-error-handler">Handling Errors with the Global Error Handler</h4>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Check the details of the error to handle cases where you should retry sending a message or stop the app</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre>
  </div>
</div>

<p>Other error related changes include:</p>

<ul>
  <li>When your listener doesn’t call <code class="language-plaintext highlighter-rouge">ack</code> within the 3 second time limit, we log the failure instead of throwing an error.</li>
  <li>If multiple errors occur when processing multiple listeners for a single event, Bolt for JavaScript will return a wrapper error with a <code class="language-plaintext highlighter-rouge">code</code> property of <code class="language-plaintext highlighter-rouge">ErrorCode.MultipleListenerError</code> and an <code class="language-plaintext highlighter-rouge">originals</code> property that contains an array of the individual errors.</li>
</ul>

<h3 id="message-shortcuts">Message Shortcuts</h3>

<p><a href="https://api.slack.com/interactivity/shortcuts/using#message_shortcuts">Message shortcuts</a> (previously referred to as message actions) now use the <code class="language-plaintext highlighter-rouge">shortcut()</code> method instead of the <code class="language-plaintext highlighter-rouge">action()</code> method.</p>

<p>Before:</p>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">action</span><span class="p">({</span> <span class="na">callback_id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">message-action-callback</span><span class="dl">'</span> <span class="p">},</span> <span class="p">({</span><span class="nx">action</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">context</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">ack</span><span class="p">();</span>
  <span class="c1">// Do stuff</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></pre>
  </div>
</div>

<p>After:</p>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">shortcut</span><span class="p">(</span><span class="dl">'</span><span class="s1">message-action-callback</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span><span class="nx">shortcut</span><span class="p">,</span> <span class="nx">ack</span><span class="p">,</span> <span class="nx">context</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">ack</span><span class="p">();</span>
  <span class="c1">// Do stuff</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></pre>
  </div>
</div>

<h3 id="upgrading-middleware">Upgrading Middleware</h3>

<p>If you wrote a custom middleware, adjust your function to <code class="language-plaintext highlighter-rouge">async</code>  and update <code class="language-plaintext highlighter-rouge">next()</code> to <code class="language-plaintext highlighter-rouge">await next()</code>. If your middleware does some post processing, instead of passing a function to <code class="language-plaintext highlighter-rouge">next()</code>, you can now run it after <code class="language-plaintext highlighter-rouge">await next()</code>.</p>

<p>Before:</p>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">noBotMessages</span><span class="p">({</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">next</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">doAfter</span><span class="p">()</span> <span class="p">{</span> 
    <span class="c1">// Post processing goes here</span>
  <span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">||</span> <span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">bot_message</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">doAfter</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
  </div>
</div>

<p>After:</p>

<div class="language-javascript highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">async</span> <span class="kd">function</span> <span class="nx">noBotMessages</span><span class="p">({</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">next</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">||</span> <span class="nx">message</span><span class="p">.</span><span class="nx">subtype</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">bot_message</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">next</span><span class="p">();</span>
    <span class="c1">// Post processing goes here</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
  </div>
</div>

<h3 id="slackbolt1x-support-schedule">@slack/bolt@1.x support schedule</h3>

<p><code class="language-plaintext highlighter-rouge">@slack/bolt@1.x</code> will be deprecated on <strong>June 30th, 2020</strong>. We plan on continuing to implement bug fixes and will also consider back-porting new features on a case by case basis up until then. Once <code class="language-plaintext highlighter-rouge">@slack/bolt@1.x</code> has been deprecated, we will only implement <strong>critical bug fixes</strong> until the official end of life date and close non critical issues and pull requests. End of life is slated for <strong>April 30th, 2021</strong>. At this time, development will fully stop for <code class="language-plaintext highlighter-rouge">@slack/bolt@1.x</code> and all remaining open issues and pull requests will be closed.</p>

<h3 id="minimum-typescript-version">Minimum TypeScript Version</h3>

<p>As outlined in our <a href="https://slack.dev/bolt/tutorial/using-typescript">using TypeScript guide</a>, <code class="language-plaintext highlighter-rouge">@slack/bolt@2.x</code> requires a minimum TypeScript version of 3.7.</p>

        </div>
    </div>

  </div>
  <script src="http://localhost:4000/bolt-js/scripts/tutorial_nav.js"></script>

  
<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-56978219-13', 'auto');
  ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>
</html>